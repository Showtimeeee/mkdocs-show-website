<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Маркетплейс "БроМаркет"</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f5f5f5;
      color: #333;
      line-height: 1.6;
    }

    /* Шапка */
    .top-bar {
      background-color: #232f3e;
      color: white;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .top-links a {
      color: white;
      text-decoration: none;
      margin-left: 1rem;
    }

    .header {
      background-color: #131921;
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .logo {
      color: white;
      font-size: 1.8rem;
      font-weight: bold;
      text-decoration: none;
      display: flex;
      align-items: center;
    }

    .logo i {
      margin-right: 0.5rem;
      color: #ff9900;
    }

    .search-bar {
      flex-grow: 1;
      max-width: 600px;
      margin: 0 1rem;
      display: flex;
    }

    .search-bar input {
      width: 100%;
      padding: 0.7rem;
      border: none;
      border-radius: 4px 0 0 4px;
    }

    .search-bar button {
      background-color: #ff9900;
      border: none;
      padding: 0 1rem;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
    }

    .nav-icons {
      display: flex;
      align-items: center;
    }

    .nav-icon {
      color: white;
      margin-left: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
    }

    .nav-icon i {
      font-size: 1.5rem;
    }

    .nav-icon span {
      font-size: 0.8rem;
      margin-top: 0.2rem;
    }

    .cart-count {
      background-color: #ff9900;
      color: black;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      top: -5px;
      right: -5px;
    }

    /* Навигация */
    .categories {
      background-color: #232f3e;
      padding: 0.7rem 1rem;
      color: white;
      display: flex;
      align-items: center;
      overflow-x: auto;
      white-space: nowrap;
    }

    .categories a {
      color: white;
      text-decoration: none;
      margin-right: 1.5rem;
      font-size: 0.9rem;
    }

    .categories a:hover {
      color: #ff9900;
    }

    /* Баннер */
    .banner {
      width: 100%;
      height: 300px;
      background-image: url('https://via.placeholder.com/1200x300/ff9900/ffffff?text=Специальные+предложения');
      background-size: cover;
      background-position: center;
      margin-bottom: 1rem;
    }

    /* Основной контент */
    .container {
      padding: 1rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    .section-title {
      font-size: 1.5rem;
      margin: 1rem 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .section-title a {
      font-size: 0.9rem;
      color: #0066c0;
      text-decoration: none;
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .product-card {
      background-color: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
    }

    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .product-image {
      height: 200px;
      width: 100%;
      object-fit: contain;
      background-color: #f7f7f7;
      padding: 1rem;
    }

    .product-badges {
      position: absolute;
      top: 10px;
      left: 10px;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .badge {
      padding: 0.2rem 0.5rem;
      border-radius: 3px;
      font-size: 0.7rem;
      font-weight: bold;
      color: white;
    }

    .badge-discount {
      background-color: #cc0c39;
    }

    .badge-new {
      background-color: #007185;
    }

    .badge-bestseller {
      background-color: #ff9900;
    }

    .product-info {
      padding: 1rem;
    }

    .product-price {
      font-weight: bold;
      font-size: 1.2rem;
      color: #b12704;
      margin: 0.5rem 0;
    }

    .product-old-price {
      text-decoration: line-through;
      color: #565959;
      font-size: 0.9rem;
      margin-left: 0.5rem;
    }

    .product-name {
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
      height: 40px;
      overflow: hidden;
      display: -webkit-box;
      -webkit-box-orient: vertical;
    }

    .product-rating {
      color: #ffa41c;
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }

    .product-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 1rem;
    }

    .add-to-cart {
      background-color: #ffd814;
      border: none;
      border-radius: 20px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-weight: 500;
      flex-grow: 1;
    }

    .add-to-cart:hover {
      background-color: #f7ca00;
    }

    .buy-now {
      background-color: #ffa41c;
      border: none;
      border-radius: 20px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-weight: 500;
      margin-left: 0.5rem;
    }

    .buy-now:hover {
      background-color: #fa8c00;
    }

    /* Барабан призов */
    .prize-section {
      background-color: white;
      padding: 2rem;
      border-radius: 8px;
      margin: 2rem 0;
      text-align: center;
    }

    .prize-title {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: #232f3e;
    }

    .prize-subtitle {
      margin-bottom: 2rem;
      color: #565959;
    }

    .wheel-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 0 auto 2rem;
    }

    .wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      position: relative;
      overflow: hidden;
      transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }

    .wheel-section {
      position: absolute;
      width: 50%;
      height: 50%;
      transform-origin: bottom right;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
    }

    .spin-button {
      background-color: #ff9900;
      color: white;
      border: none;
      border-radius: 50%;
      width: 80px;
      height: 80px;
      font-size: 1.2rem;
      font-weight: bold;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      cursor: pointer;
      z-index: 10;
    }

    .spin-button:hover {
      background-color: #ff8c00;
    }

    .spin-button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }

    .pointer {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-top: 30px solid #ff9900;
      z-index: 5;
    }

    /* Кэшбек и бонусы */
    .cashback-info {
      background-color: #f0f2f2;
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .cashback-amount {
      font-weight: bold;
      color: #b12704;
      font-size: 1.2rem;
    }

    /* Модальные окна */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: white;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      animation: modalFadeIn 0.3s ease;
    }

    .modal-header {
      padding: 1rem;
      border-bottom: 1px solid #ddd;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 1.3rem;
      font-weight: bold;
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #555;
    }

    .modal-body {
      padding: 1rem;
    }

    .cart-item {
      display: flex;
      padding: 1rem 0;
      border-bottom: 1px solid #eee;
    }

    .cart-item-image {
      width: 80px;
      height: 80px;
      object-fit: contain;
      margin-right: 1rem;
    }

    .cart-item-details {
      flex-grow: 1;
    }

    .cart-item-name {
      font-weight: 500;
      margin-bottom: 0.5rem;
    }

    .cart-item-price {
      font-weight: bold;
      color: #b12704;
    }

    .cart-item-actions {
      display: flex;
      align-items: center;
    }

    .quantity-control {
      display: flex;
      align-items: center;
      margin-right: 1rem;
    }

    .quantity-btn {
      background-color: #f0f2f2;
      border: none;
      width: 25px;
      height: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .quantity-input {
      width: 40px;
      text-align: center;
      border: 1px solid #ddd;
      margin: 0 5px;
    }

    .remove-item {
      color: #0066c0;
      background: none;
      border: none;
      cursor: pointer;
    }

    .cart-summary {
      padding: 1rem;
      border-top: 1px solid #ddd;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }

    .total {
      font-weight: bold;
      font-size: 1.2rem;
      margin-top: 1rem;
    }

    .checkout-btn {
      background-color: #ffd814;
      border: none;
      border-radius: 8px;
      padding: 0.8rem;
      width: 100%;
      font-weight: bold;
      margin-top: 1rem;
      cursor: pointer;
    }

    .checkout-btn:hover {
      background-color: #f7ca00;
    }

    /* Анимации */
    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Адаптация */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        align-items: stretch;
      }

      .search-bar {
        margin: 1rem 0;
        max-width: 100%;
      }

      .nav-icons {
        justify-content: space-around;
        margin-top: 1rem;
      }

      .nav-icon {
        margin: 0;
      }

      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }

      .product-image {
        height: 150px;
      }

      .product-actions {
        flex-direction: column;
      }

      .buy-now {
        margin-left: 0;
        margin-top: 0.5rem;
      }

      .wheel-container {
        width: 250px;
        height: 250px;
      }
    }
  </style>
</head>
<body>

<!-- Верхняя панель -->
<div class="top-bar">
  <div>Добро пожаловать в БроМаркет!</div>
  <div class="top-links">
    <a href="#"><i class="fas fa-headset"></i> Помощь</a>
    <a href="#"><i class="fas fa-user"></i> Аккаунт</a>
    <a href="#"><i class="fas fa-heart"></i> Избранное</a>
  </div>
</div>

<!-- Шапка с лого и поиском -->
<header class="header">
  <a href="#" class="logo">
    <i class="fas fa-shopping-bag"></i> БроМаркет
  </a>
  
  <div class="search-bar">
    <input type="text" placeholder="Поиск товаров...">
    <button><i class="fas fa-search"></i></button>
  </div>
  
  <div class="nav-icons">
    <div class="nav-icon" onclick="toggleModal('accountModal')">
      <i class="fas fa-user"></i>
      <span>Профиль</span>
    </div>
    <div class="nav-icon" onclick="toggleModal('favoritesModal')">
      <i class="fas fa-heart"></i>
      <span>Избранное</span>
    </div>
    <div class="nav-icon" onclick="toggleModal('cartModal')">
      <div style="position: relative;">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count" id="cartCount">0</span>
      </div>
      <span>Корзина</span>
    </div>
  </div>
</header>

<!-- Навигация по категориям -->
<nav class="categories">
  <a href="#"><i class="fas fa-bars"></i> Все категории</a>
  <a href="#"><i class="fas fa-laugh-squint"></i> Для души</a>
  <a href="#"><i class="fas fa-utensils"></i> Для кухни</a>
  <a href="#"><i class="fas fa-couch"></i> Для дома</a>
  <a href="#"><i class="fas fa-gift"></i> Непонятное</a>
  <a href="#"><i class="fas fa-question-circle"></i> Зачем это?</a>
</nav>

<!-- Баннер -->
<div class="banner"></div>

<!-- Основной контент -->
<div class="container">
  <!-- Рекомендуемые товары -->
  <div class="section-title">
    <h2>Рекомендуем вам</h2>
    <a href="#">Смотреть все</a>
  </div>
  
  <div class="products-grid" id="recommendedProducts">
    <!-- Товары будут добавлены через JS -->
  </div>

  <!-- Товары со скидкой -->
  <div class="section-title">
    <h2>Скидки до 70%</h2>
    <a href="#">Смотреть все</a>
  </div>
  
  <div class="products-grid" id="discountedProducts">
    <!-- Товары будут добавлены через JS -->
  </div>

  <!-- Барабан призов -->
  <div class="prize-section">
    <h2 class="prize-title">Крутите барабан и выигрывайте призы!</h2>
    <p class="prize-subtitle">Каждый день один бесплатный шанс</p>
    
    <div class="wheel-container">
      <div class="pointer"></div>
      <div class="wheel" id="wheel">
        <!-- Секции будут добавлены через JS -->
      </div>
      <button class="spin-button" id="spinButton" onclick="spinWheel()">Крутить!</button>
    </div>
    
    <div class="cashback-info">
      <div>
        <div>Ваш кэшбек:</div>
        <div class="cashback-amount" id="cashbackAmount">0 ₽</div>
      </div>
      <button class="checkout-btn" style="max-width: 200px;">Использовать кэшбек</button>
    </div>
  </div>

  <!-- Популярные товары -->
  <div class="section-title">
    <h2>Популярные товары</h2>
    <a href="#">Смотреть все</a>
  </div>
  
  <div class="products-grid" id="popularProducts">
    <!-- Товары будут добавлены через JS -->
  </div>
</div>

<!-- Модальное окно корзины -->
<div class="modal" id="cartModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Ваша корзина</div>
      <button class="close-modal" onclick="toggleModal('cartModal')">&times;</button>
    </div>
    <div class="modal-body" id="cartItems">
      <!-- Товары в корзине будут добавлены через JS -->
    </div>
    <div class="cart-summary">
      <div class="summary-row">
        <span>Товары (3)</span>
        <span>12 450 ₽</span>
      </div>
      <div class="summary-row">
        <span>Скидка</span>
        <span>-1 245 ₽</span>
      </div>
      <div class="summary-row">
        <span>Доставка</span>
        <span>Бесплатно</span>
      </div>
      <div class="summary-row total">
        <span>Итого</span>
        <span>11 205 ₽</span>
      </div>
      <button class="checkout-btn">Перейти к оформлению</button>
    </div>
  </div>
</div>

<!-- Модальное окно аккаунта -->
<div class="modal" id="accountModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Ваш профиль</div>
      <button class="close-modal" onclick="toggleModal('accountModal')">&times;</button>
    </div>
    <div class="modal-body">
      <div style="text-align: center; margin-bottom: 1rem;">
        <div style="width: 80px; height: 80px; background-color: #ddd; border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center;">
          <i class="fas fa-user" style="font-size: 2rem; color: #777;"></i>
        </div>
        <div style="font-weight: bold;">Покупатель Покупателевич</div>
        <div style="color: #777; font-size: 0.9rem;">pokupatel@example.com</div>
      </div>
      
      <div style="margin-bottom: 1rem;">
        <div style="font-weight: bold; margin-bottom: 0.5rem;">Бонусные баллы</div>
        <div style="display: flex; align-items: center; justify-content: space-between; background-color: #f0f2f2; padding: 0.8rem; border-radius: 8px;">
          <div>
            <div style="font-size: 0.9rem;">Накоплено</div>
            <div style="font-weight: bold; color: #b12704;">1 245 баллов</div>
          </div>
          <button style="background-color: #ff9900; color: white; border: none; border-radius: 20px; padding: 0.5rem 1rem; cursor: pointer;">Использовать</button>
        </div>
      </div>
      
      <div style="margin-bottom: 1rem;">
        <div style="font-weight: bold; margin-bottom: 0.5rem;">Мои заказы</div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
          <span>Всего заказов</span>
          <span>12</span>
        </div>
        <div style="display: flex; justify-content: space-between;">
          <span>На сумму</span>
          <span>56 789 ₽</span>
        </div>
      </div>
      
      <button style="width: 100%; padding: 0.8rem; background-color: #f0f2f2; border: none; border-radius: 8px; margin-top: 1rem; cursor: pointer;">Выйти</button>
    </div>
  </div>
</div>

<!-- Модальное окно избранного -->
<div class="modal" id="favoritesModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Избранное</div>
      <button class="close-modal" onclick="toggleModal('favoritesModal')">&times;</button>
    </div>
    <div class="modal-body">
      <div style="text-align: center; padding: 2rem 0;">
        <i class="fas fa-heart" style="font-size: 3rem; color: #ddd; margin-bottom: 1rem;"></i>
        <div style="font-weight: bold; margin-bottom: 0.5rem;">В избранном пока пусто</div>
        <div style="color: #777; margin-bottom: 1rem;">Добавляйте товары в избранное, чтобы не потерять</div>
        <button style="background-color: #ff9900; color: white; border: none; border-radius: 20px; padding: 0.7rem 1.5rem; cursor: pointer;">Перейти к покупкам</button>
      </div>
    </div>
  </div>
</div>

<!-- Модальное окно выигрыша -->
<div class="modal" id="prizeModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Поздравляем!</div>
      <button class="close-modal" onclick="toggleModal('prizeModal')">&times;</button>
    </div>
    <div class="modal-body" style="text-align: center; padding: 2rem 0;">
      <div id="prizeResult" style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem; color: #b12704;"></div>
      <div style="margin-bottom: 1.5rem;">Ваш приз уже добавлен в ваш аккаунт</div>
      <button style="background-color: #ff9900; color: white; border: none; border-radius: 20px; padding: 0.7rem 1.5rem; cursor: pointer;">Отлично!</button>
    </div>
  </div>
</div>

<script>
  // Данные товаров с юмором
  const products = [
    {
      id: 1,
      name: "Вечный двигатель (работает от батареек)",
      price: 9999,
      oldPrice: 19999,
      image: "https://via.placeholder.com/250x250/cccccc/ffffff?text=Вечный+двигатель",
      rating: 4.2,
      reviews: 42,
      discount: 50,
      badges: ["bestseller"],
      category: "unclear"
    },
    {
      id: 2,
      name: "Набор 'Сам себе барбер' (очень острый)",
      price: 1499,
      oldPrice: 2999,
      image: "https://via.placeholder.com/250x250/cccccc/ffffff?text=Барбер+набор",
      rating: 3.8,
      reviews: 128,
      discount: 50,
      badges: [],
      category: "for_soul"
    },
    {
      id: 3,
      name: "Ложка для макарон с отверстием (наконец-то!)",
      price: 399,
      oldPrice: 599,
      image: "https://via.placeholder.com/250x250/cccccc/ffffff?text=Ложка+для+макарон",
      rating: 4.9,
      reviews: 512,
      discount: 33,
      badges: ["bestseller", "new"],
      category: "for_kitchen"
    },
    {
      id: 4,
      name: "Подставка для 10 телефонов (на всякий случай)",
      price: 1299,
      oldPrice: 1599,
      image: "https://via.placeholder.com/250x250/cccccc/ffffff?text=Подставка+для+телефонов",
      rating: 4.1,
      reviews: 87,
      discount: 19,
      badges: [],
      category: "for_home"
    },
    {
      id: 5,
      name: "Коврик для мышки с подогревом (чтобы пальцам тепло)",
      price: 1999,
      oldPrice: 2499,
      image: "https://via.placeholder.com/250x250/cccccc/ffffff?text=Коврик+с+подогревом",
      rating: 4.5,
      reviews: 231,
      discount: 20,
      badges: ["new"],
      category: "for_home"
    },
    {
      id: 6,
      name: "USB-хаб на 127 портов (мало не покажется)",
      price: 4999,
      oldPrice: 7999,
      image: "https://via.placeholder.com/250x250/cccccc/ffffff?text=USB+хаб",
      rating: 3.9,
      reviews: 64,
      discount: 38,
      badges: [],
      category: "unclear"
    },
    {
      id: 7,
      name: "Набор 'Собери ИКЕА-мебель без нервов' (шутка)",
      price: 999,
      oldPrice: 1999,
      image: "https://via.placeholder.com/250x250/cccccc/ffffff?text=Набор+ИКЕА",
      rating: 2.5,
      reviews: 342,
      discount: 50,
      badges: [],
      category: "for_home"
    },
    {
      id: 8,
      name: "Беспроводные наушники с проводом для зарядки",
      price: 2999,
      oldPrice: 4999,
      image: "https://via.placeholder.com/250x250/cccccc/ffffff?text=Наушники+с+проводом",
      rating: 4.0,
      reviews: 198,
      discount: 40,
      badges: ["bestseller"],
      category: "unclear"
    },
    {
      id: 9,
      name: "Книга 'Как ничего не делать' (365 страниц)",
      price: 899,
      oldPrice: 1299,
      image: "https://via.placeholder.com/250x250/cccccc/ffffff?text=Книга+безделья",
      rating: 4.7,
      reviews: 421,
      discount: 31,
      badges: ["bestseller"],
      category: "for_soul"
    },
    {
      id: 10,
      name: "Набор 'Сделай сам пельмени' (мука и вода в комплект не входят)",
      price: 599,
      oldPrice: 999,
      image: "https://via.placeholder.com/250x250/cccccc/ffffff?text=Набор+пельмени",
      rating: 3.2,
      reviews: 156,
      discount: 40,
      badges: [],
      category: "for_kitchen"
    },
    {
      id: 11,
      name: "Подогреватель для холодного кофе (чтобы не остывал)",
      price: 1499,
      oldPrice: 1999,
      image: "https://via.placeholder.com/250x250/cccccc/ffffff?text=Подогреватель+кофе",
      rating: 3.5,
      reviews: 87,
      discount: 25,
      badges: [],
      category: "for_kitchen"
    },
    {
      id: 12,
      name: "Коврик для йоги с разметкой 'где какая нога'",
      price: 1299,
      oldPrice: 1799,
      image: "https://via.placeholder.com/250x250/cccccc/ffffff?text=Коврик+для+йоги",
      rating: 4.3,
      reviews: 213,
      discount: 28,
      badges: ["new"],
      category: "for_soul"
    }
  ];

  // Корзина
  let cart = [];
  let cashback = 0;

  // Инициализация при загрузке страницы
  document.addEventListener('DOMContentLoaded', function() {
    renderProducts();
    initWheel();
    updateCartCount();
  });

  // Рендер товаров
  function renderProducts() {
    const recommendedProducts = document.getElementById('recommendedProducts');
    const discountedProducts = document.getElementById('discountedProducts');
    const popularProducts = document.getElementById('popularProducts');
    
    // Очищаем контейнеры
    recommendedProducts.innerHTML = '';
    discountedProducts.innerHTML = '';
    popularProducts.innerHTML = '';
    
    // Рендерим товары
    products.forEach(product => {
      const productCard = createProductCard(product);
      
      // Добавляем товары в разные секции
      recommendedProducts.appendChild(productCard.cloneNode(true));
      
      if (product.discount > 30) {
        discountedProducts.appendChild(productCard.cloneNode(true));
      }
      
      if (product.rating >= 4.5 || product.badges.includes("bestseller")) {
        popularProducts.appendChild(productCard.cloneNode(true));
      }
    });
  }

  // Создание карточки товара
  function createProductCard(product) {
    const card = document.createElement('div');
    card.className = 'product-card';
    
    // Бейджи
    let badgesHTML = '';
    if (product.badges.includes("bestseller")) {
      badgesHTML += '<div class="badge badge-bestseller">Хит</div>';
    }
    if (product.badges.includes("new")) {
      badgesHTML += '<div class="badge badge-new">Новинка</div>';
    }
    
    // Рейтинг
    let ratingHTML = '';
    for (let i = 1; i <= 5; i++) {
      if (i <= Math.floor(product.rating)) {
        ratingHTML += '<i class="fas fa-star"></i>';
      } else if (i - 0.5 <= product.rating) {
        ratingHTML += '<i class="fas fa-star-half-alt"></i>';
      } else {
        ratingHTML += '<i class="far fa-star"></i>';
      }
    }
    
    // Старая цена
    let oldPriceHTML = '';
    if (product.oldPrice) {
      oldPriceHTML = `<span class="product-old-price">${formatPrice(product.oldPrice)} ₽</span>`;
    }
    
    card.innerHTML = `
      <div class="product-badges">${badgesHTML}</div>
      <img src="${product.image}" alt="${product.name}" class="product-image">
      <div class="product-info">
        <div class="product-name">${product.name}</div>
        <div class="product-rating">
          ${ratingHTML} ${product.rating} (${product.reviews})
        </div>
        <div class="product-price">
          ${formatPrice(product.price)} ₽ ${oldPriceHTML}
        </div>
        <div class="product-actions">
          <button class="add-to-cart" onclick="addToCart(${product.id})">В корзину</button>
          <button class="buy-now" onclick="buyNow(${product.id})">Купить</button>
        </div>
      </div>
    `;
    
    return card;
  }

  // Форматирование цены
  function formatPrice(price) {
    return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
  }

  // Добавление в корзину
  function addToCart(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;
    
    const existingItem = cart.find(item => item.id === productId);
    if (existingItem) {
      existingItem.quantity += 1;
    } else {
      cart.push({
        ...product,
        quantity: 1
      });
    }
    
    updateCartCount();
    showToast(`Товар "${product.name}" добавлен в корзину`);
  }

  // Купить сейчас
  function buyNow(productId) {
    addToCart(productId);
    toggleModal('cartModal');
  }

  // Обновление счетчика корзины
  function updateCartCount() {
    const count = cart.reduce((total, item) => total + item.quantity, 0);
    document.getElementById('cartCount').textContent = count;
    
    // Обновляем содержимое корзины в модальном окне
    updateCartModal();
  }

  // Обновление модального окна корзины
  function updateCartModal() {
    const cartItems = document.getElementById('cartItems');
    cartItems.innerHTML = '';
    
    if (cart.length === 0) {
      cartItems.innerHTML = `
        <div style="text-align: center; padding: 2rem 0;">
          <i class="fas fa-shopping-cart" style="font-size: 3rem; color: #ddd; margin-bottom: 1rem;"></i>
          <div style="font-weight: bold; margin-bottom: 0.5rem;">Корзина пуста</div>
          <div style="color: #777; margin-bottom: 1rem;">Добавьте товары, чтобы сделать заказ</div>
          <button style="background-color: #ff9900; color: white; border: none; border-radius: 20px; padding: 0.7rem 1.5rem; cursor: pointer;" onclick="toggleModal('cartModal')">Перейти к покупкам</button>
        </div>
      `;
      return;
    }
    
    let totalPrice = 0;
    let totalDiscount = 0;
    
    cart.forEach(item => {
      const itemElement = document.createElement('div');
      itemElement.className = 'cart-item';
      
      const itemPrice = item.price * item.quantity;
      const itemOldPrice = item.oldPrice ? item.oldPrice * item.quantity : itemPrice;
      const itemDiscount = itemOldPrice - itemPrice;
      
      totalPrice += itemPrice;
      totalDiscount += itemDiscount;
      
      itemElement.innerHTML = `
        <img src="${item.image}" alt="${item.name}" class="cart-item-image">
        <div class="cart-item-details">
          <div class="cart-item-name">${item.name}</div>
          <div class="cart-item-price">${formatPrice(item.price)} ₽</div>
        </div>
        <div class="cart-item-actions">
          <div class="quantity-control">
            <button class="quantity-btn" onclick="updateQuantity(${item.id}, ${item.quantity - 1})">-</button>
            <input type="text" class="quantity-input" value="${item.quantity}" readonly>
            <button class="quantity-btn" onclick="updateQuantity(${item.id}, ${item.quantity + 1})">+</button>
          </div>
          <button class="remove-item" onclick="removeFromCart(${item.id})">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      `;
      
      cartItems.appendChild(itemElement);
    });
    
    // Обновляем итоговую сумму
    document.querySelector('.cart-summary .summary-row:nth-child(1) span:last-child').textContent = `${formatPrice(totalPrice)} ₽`;
    document.querySelector('.cart-summary .summary-row:nth-child(2) span:last-child').textContent = `-${formatPrice(totalDiscount)} ₽`;
    document.querySelector('.cart-summary .total span:last-child').textContent = `${formatPrice(totalPrice)} ₽`;
    document.querySelector('.cart-summary .summary-row:nth-child(1) span:first-child').textContent = `Товары (${cart.reduce((total, item) => total + item.quantity, 0)})`;
  }

  // Обновление количества товара
  function updateQuantity(productId, newQuantity) {
    if (newQuantity < 1) {
      removeFromCart(productId);
      return;
    }
    
    const item = cart.find(item => item.id === productId);
    if (item) {
      item.quantity = newQuantity;
      updateCartCount();
    }
  }

  // Удаление из корзины
  function removeFromCart(productId) {
    cart = cart.filter(item => item.id !== productId);
    updateCartCount();
  }

  // Переключение модального окна
  function toggleModal(modalId) {
    const modal = document.getElementById(modalId);
    modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
    
    // Блокируем прокрутку страницы при открытом модальном окне
    document.body.style.overflow = modal.style.display === 'flex' ? 'hidden' : '';
  }

  // Показ уведомления
  function showToast(message) {
    const toast = document.createElement('div');
    toast.style.position = 'fixed';
    toast.style.bottom = '20px';
    toast.style.left = '50%';
    toast.style.transform = 'translateX(-50%)';
    toast.style.backgroundColor = '#333';
    toast.style.color = 'white';
    toast.style.padding = '12px 24px';
    toast.style.borderRadius = '4px';
    toast.style.zIndex = '1000';
    toast.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
    toast.style.animation = 'fadeIn 0.3s, fadeOut 0.3s 2.7s';
    toast.textContent = message;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
      document.body.removeChild(toast);
    }, 3000);
  }

  // Инициализация барабана
  function initWheel() {
    const wheel = document.getElementById('wheel');
    const prizes = [
      { text: "100 ₽", value: 100, color: "#ff9900" },
      { text: "50 ₽", value: 50, color: "#ffcc00" },
      { text: "200 ₽", value: 200, color: "#ff6600" },
      { text: "Бесплатная доставка", value: 0, color: "#00a8e8" },
      { text: "10% скидка", value: 0, color: "#28a745" },
      { text: "Повезёт в другой раз", value: 0, color: "#6c757d" }
    ];
    
    wheel.innerHTML = '';
    
    prizes.forEach((prize, index) => {
      const section = document.createElement('div');
      section.className = 'wheel-section';
      section.textContent = prize.text;
      section.style.backgroundColor = prize.color;
      section.style.transform = `rotate(${index * (360 / prizes.length)}deg)`;
      section.style.clipPath = 'polygon(0 0, 100% 0, 100% 100%)';
      
      wheel.appendChild(section);
    });
  }

  // Вращение барабана
  function spinWheel() {
    const wheel = document.getElementById('wheel');
    const spinButton = document.getElementById('spinButton');
    const prizes = [
      { text: "100 ₽", value: 100 },
      { text: "50 ₽", value: 50 },
      { text: "200 ₽", value: 200 },
      { text: "Бесплатная доставка", value: 0 },
      { text: "10% скидка", value: 0 },
      { text: "Повезёт в другой раз", value: 0 }
    ];
    
    // Отключаем кнопку на время вращения
    spinButton.disabled = true;
    
    // Случайный угол вращения (минимум 2 полных оборота)
    const spinDegrees = 720 + Math.floor(Math.random() * 360);
    
    // Вращаем барабан
    wheel.style.transform = `rotate(${spinDegrees}deg)`;
    
    // После завершения вращения
    setTimeout(() => {
      // Определяем выигранный приз
      const prizeIndex = Math.floor((spinDegrees % 360) / (360 / prizes.length));
      const prize = prizes[prizeIndex];
      
      // Обновляем кэшбек, если выиграли деньги
      if (prize.value > 0) {
        cashback += prize.value;
        document.getElementById('cashbackAmount').textContent = `${cashback} ₽`;
      }
      
      // Показываем результат
      document.getElementById('prizeResult').textContent = `Вы выиграли: ${prize.text}`;
      toggleModal('prizeModal');
      
      // Включаем кнопку снова
      spinButton.disabled = false;
    }, 4000);
  }
</script>

</body>
</html>