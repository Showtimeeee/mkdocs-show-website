<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="dna" href="images/pub_5878406.png"/>
    <title>Магия Таверны - Карточная Игра</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Times New Roman', serif;
            background: url('./images/iskustve.jpg') no-repeat center center fixed;
            background-size: cover;
            color: #e8d8b6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: background-image 1.5s ease-in-out;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: -1;
        }

        .tavern-container {
            max-width: 900px;
            width: 100%;
            background: rgba(20, 10, 5, 0.7);
            border: 1px solid rgba(139, 69, 19, 0.6);
            border-radius: 10px;
            padding: 25px;
            backdrop-filter: blur(5px);
            position: relative;
            z-index: 10;
            max-height: 95vh;
            display: flex;
            flex-direction: column;
        }

        .tavern-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            position: relative;
            flex-shrink: 0;
        }

        .tavern-title {
            font-size: 2.2em;
            color: #d4af37;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.9);
            margin-bottom: 8px;
            font-family: 'Cambria', serif;
        }

        .tavern-subtitle {
            font-size: 1.1em;
            color: #b8860b;
            font-style: italic;
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.8);
        }

        /* Кнопка помощи */
        .help-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(212, 175, 55, 0.3);
            color: #d4af37;
            border: 1px solid #d4af37;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .help-button:hover {
            background: rgba(212, 175, 55, 0.5);
            transform: scale(1.1);
        }

        /* Модальное окно */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(20, 10, 5, 0.95);
            border: 2px solid #d4af37;
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
        }

        .close-button {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #d4af37;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-button:hover {
            color: #ff6b6b;
            transform: scale(1.1);
        }

        .rules-title {
            color: #d4af37;
            text-align: center;
            margin-bottom: 25px;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        /* Игровое поле - ФИКСИРОВАННАЯ ВЫСОТА */
        .game-board {
            display: flex;
            flex-direction: column;
            gap: 15px;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }

        .battlefield {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 15px;
            background: rgba(20, 10, 5, 0.4);
            border-radius: 8px;
            border: 1px solid rgba(139, 69, 19, 0.4);
            min-height: 200px;
            max-height: 250px;
            overflow: hidden;
        }

        .player-side, .computer-side {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            padding: 8px;
            align-content: start;
        }

        .player-hand {
            display: flex;
            justify-content: center;
            gap: 8px;
            min-height: 120px;
            max-height: 140px;
            padding: 12px;
            background: rgba(20, 10, 5, 0.5);
            border-radius: 8px;
            border: 1px solid rgba(139, 69, 19, 0.4);
            overflow-x: auto;
            flex-shrink: 0;
        }

        .card {
            width: 80px;
            height: 110px;
            background: linear-gradient(135deg, #8b4513, #654321);
            border: 2px solid #d4af37;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 6px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
            flex-shrink: 0;
        }

        .card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 4px 4px 20px rgba(212, 175, 55, 0.3);
        }

        .card.in-hand {
            background: linear-gradient(135deg, #2d5016, #1a2f0d);
        }

        .card.played {
            background: linear-gradient(135deg, #1a2f0d, #0d1f05);
        }

        .card.computer {
            background: linear-gradient(135deg, #501616, #2f0d0d);
        }

        .card-value {
            font-size: 1.6em;
            font-weight: bold;
            color: #d4af37;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }
        
        .audio-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(20, 10, 5, 0.85);
            padding: 12px 0;
            border-top: 1px solid rgba(139, 69, 19, 0.6);
            backdrop-filter: blur(5px);
            z-index: 20;
            display: flex;
            justify-content: center;
        }

        .audio-footer audio {
            width: 300px;
        }

        .card-suit {
            font-size: 1.1em;
            color: #e8d8b6;
        }

        .card-cost {
            position: absolute;
            top: 3px;
            left: 3px;
            background: rgba(0, 0, 0, 0.7);
            color: #ff6b6b;
            padding: 2px 5px;
            border-radius: 8px;
            font-size: 0.7em;
            font-weight: bold;
        }

        .game-status {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 15px;
            align-items: center;
            padding: 12px;
            background: rgba(20, 10, 5, 0.6);
            border-radius: 8px;
            border: 1px solid rgba(139, 69, 19, 0.4);
            flex-shrink: 0;
        }

        .player-stats, .computer-stats {
            text-align: center;
        }

        /* УВЕЛИЧЕННЫЕ ЦИФРЫ МАНЫ */
        .mana {
            font-size: 2em;
            color: #4d94ff;
            font-weight: bold;
            text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.9);
            margin: 8px 0;
        }

        .mana-icon {
            font-size: 1.6em;
            margin-right: 6px;
        }

        .mana-value {
            font-size: 1.2em;
            background: rgba(77, 148, 255, 0.2);
            padding: 4px 10px;
            border-radius: 15px;
            border: 2px solid #4d94ff;
        }

        .score {
            font-size: 2em;
            color: #d4af37;
            font-weight: bold;
            text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.9);
            margin: 8px 0;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }

        .action-button {
            background: linear-gradient(45deg, rgba(139, 69, 19, 0.8), rgba(160, 82, 45, 0.8));
            color: #e8d8b6;
            border: none;
            padding: 10px 20px;
            font-size: 1em;
            font-family: 'Cambria', serif;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(139, 69, 19, 0.4);
            backdrop-filter: blur(5px);
        }

        .action-button:hover {
            background: linear-gradient(45deg, rgba(160, 82, 45, 0.9), rgba(139, 69, 19, 0.9));
            transform: translateY(-2px);
        }

        .action-button:disabled {
            background: rgba(90, 90, 90, 0.6);
            cursor: not-allowed;
            transform: none;
        }

        .combinations {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .combination {
            background: rgba(212, 175, 55, 0.2);
            border: 1px solid #d4af37;
            border-radius: 12px;
            padding: 4px 10px;
            font-size: 0.7em;
            color: #e8d8b6;
        }

        /* ИСПРАВЛЕННЫЙ ЛОГ - СВЕЖИЕ СООБЩЕНИЯ СВЕРХУ */
        .game-log {
            background: rgba(20, 10, 5, 0.6);
            border: 1px solid rgba(139, 69, 19, 0.5);
            border-radius: 8px;
            padding: 12px;
            height: 120px;
            overflow-y: auto;
            margin-top: 10px;
            backdrop-filter: blur(3px);
            scroll-behavior: smooth;
            flex-shrink: 0;
        }

        .game-log::-webkit-scrollbar {
            width: 6px;
        }

        .game-log::-webkit-scrollbar-track {
            background: rgba(139, 69, 19, 0.2);
            border-radius: 3px;
        }

        .game-log::-webkit-scrollbar-thumb {
            background: #d4af37;
            border-radius: 3px;
        }

        .game-log::-webkit-scrollbar-thumb:hover {
            background: #b8860b;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .log-title {
            color: #d4af37;
            font-size: 1em;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
        }

        .clear-log-button {
            background: rgba(139, 69, 19, 0.5);
            color: #e8d8b6;
            border: 1px solid #8b4513;
            border-radius: 10px;
            padding: 3px 8px;
            font-size: 0.7em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-log-button:hover {
            background: rgba(139, 69, 19, 0.7);
        }

        .log-entries {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .log-entry {
            padding: 6px 8px;
            border-radius: 5px;
            background: rgba(0, 0, 0, 0.3);
            border-left: 3px solid #d4af37;
            font-size: 0.8em;
            line-height: 1.3;
            animation: slideIn 0.3s ease;
        }

        .log-entry:first-child {
            background: rgba(212, 175, 55, 0.1);
            border-left: 3px solid #ff6b6b;
            font-weight: bold;
        }

        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateY(-8px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .turn-indicator {
            text-align: center;
            font-size: 1.1em;
            color: #d4af37;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
            margin-bottom: 8px;
            padding: 6px 12px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        @media (max-width: 768px) {
            .tavern-container {
                max-width: 95%;
                padding: 15px;
                max-height: 90vh;
            }
            
            .card {
                width: 65px;
                height: 90px;
            }
            
            .battlefield {
                grid-template-columns: 1fr;
                gap: 8px;
                max-height: 300px;
            }
            
            .game-status {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .mana {
                font-size: 1.6em;
            }
            
            .score {
                font-size: 1.6em;
            }
        }

        .bg-indicator {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.5);
            color: #e8d8b6;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            backdrop-filter: blur(5px);
            z-index: 100;
        }
    </style>
</head>
<body>
    <div class="bg-indicator" id="bgIndicator">Фон 1/3</div>

    <!-- Модальное окно с правилами -->
    <div class="modal" id="rulesModal">
        <div class="modal-content">
            <button class="close-button" id="closeRules">&times;</button>
            <h2 class="rules-title">📜 Правила Магии Таверны</h2>
            
            <!-- Содержимое правил остается таким же -->
            <div class="rules-section">
                <h3>🎯 Цель игры</h3>
                <p>Победить трактирщика, набрав больше очков за счет разыгрывания карт и сбора комбинаций.</p>
            </div>
            <!-- ... остальные правила ... -->
        </div>
    </div>

    <div class="tavern-container">
        <header class="tavern-header">
            <h1 class="tavern-title">🃏 Магия Таверны 🍻</h1>
            <p class="tavern-subtitle">Собери сильнейшие комбинации и победи трактирщика!</p>
            <button class="help-button" id="helpButton">?</button>
        </header>

        <div class="game-board">
            <div class="battlefield">
                <div class="computer-side" id="computerSide">
                    <!-- Карты компьютера будут добавляться здесь -->
                </div>
                
                <div class="player-side" id="playerSide">
                    <!-- Карты игрока будут добавляться здесь -->
                </div>
            </div>

            <div class="player-hand" id="playerHand">
                <!-- Карты в руке будут добавляться здесь -->
            </div>

            <div class="game-status">
                <div class="computer-stats">
                    <div class="score" id="computerScore">0</div>
                    <div class="mana">
                        <span class="mana-icon">⚡</span>
                        <span class="mana-value" id="computerManaValue">5/5</span>
                    </div>
                </div>

                <div class="controls">
                    <div class="turn-indicator" id="turnIndicator">Ваш ход</div>
                    <button class="action-button" id="endTurnButton">Завершить ход</button>
                    <button class="action-button" id="newGameButton">Новая игра</button>
                    <div class="combinations" id="activeCombinations">
                        <!-- Активные комбинации -->
                    </div>
                </div>

                <div class="player-stats">
                    <div class="score" id="playerScore">0</div>
                    <div class="mana">
                        <span class="mana-icon">⚡</span>
                        <span class="mana-value" id="playerManaValue">5/5</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="game-log">
            <div class="log-header">
                <h3 class="log-title">Хроники магической дуэли:</h3>
                <button class="clear-log-button" id="clearLogButton">Очистить</button>
            </div>
            <div class="log-entries" id="gameLog">
                <!-- Записи лога будут добавляться здесь -->
            </div>
        </div>
    </div>

    <script>
        class CardGame {
            constructor() {
                this.player = {
                    hand: [],
                    battlefield: [],
                    mana: 5,
                    maxMana: 5,
                    score: 0
                };
                
                this.computer = {
                    hand: [],
                    battlefield: [],
                    mana: 5,
                    maxMana: 5,
                    score: 0
                };
                
                this.turn = 'player';
                this.round = 1;
                this.currentBgIndex = 0;
                this.backgrounds = [
                    './images/iskustve.jpg',
                    './images/andrew-krivulya-inn-art-3-d-taverna.jpg',
                    './images/devushka-elf-mag-boy-taverna.jpg',
                    './images/dota2-igra-fantasy-brewmaster.jpg',
                    './images/katrin-dance.jpg',
                    './images/the-witcher-3-wild-hunt-3864.jpg',
                    './images/the-witcher-geralt-taverna.jpg',
                    './images/viking-kokteyl-taverna.jpg',
                    './images/igra-devushka-taverna-the-elder-scrolls-v-skyrim-zlfiika-gam.jpg',
                ];

                
                this.cardTypes = [
                    { name: 'Воин', value: 2, cost: 1, suit: '⚔️' },
                    { name: 'Лучник', value: 3, cost: 2, suit: '🏹' },
                    { name: 'Маг', value: 4, cost: 3, suit: '🔮' },
                    { name: 'Рыцарь', value: 5, cost: 4, suit: '🛡️' },
                    { name: 'Дракон', value: 6, cost: 5, suit: '🐉' },
                    { name: 'Единорог', value: 7, cost: 6, suit: '🦄' }
                ];
                
                this.combinations = {
                    'Тройка воинов': { cards: 3, value: 2, bonus: 5 },
                    'Дуэль магов': { cards: 2, value: 4, bonus: 8 },
                    'Стражи замка': { cards: 2, value: 5, bonus: 10 },
                    'Легенды': { cards: 2, value: 6, bonus: 12 }
                };
                
                this.initializeElements();
                this.setupEventListeners();
                this.startBackgroundRotation();
                this.startNewGame();
            }

            initializeElements() {
                this.playerHand = document.getElementById('playerHand');
                this.playerSide = document.getElementById('playerSide');
                this.computerSide = document.getElementById('computerSide');
                this.playerScore = document.getElementById('playerScore');
                this.computerScore = document.getElementById('computerScore');
                this.playerManaValue = document.getElementById('playerManaValue');
                this.computerManaValue = document.getElementById('computerManaValue');
                this.endTurnButton = document.getElementById('endTurnButton');
                this.newGameButton = document.getElementById('newGameButton');
                this.turnIndicator = document.getElementById('turnIndicator');
                this.activeCombinations = document.getElementById('activeCombinations');
                this.gameLog = document.getElementById('gameLog');
                this.clearLogButton = document.getElementById('clearLogButton');
                this.bgIndicator = document.getElementById('bgIndicator');
                this.helpButton = document.getElementById('helpButton');
                this.rulesModal = document.getElementById('rulesModal');
                this.closeRules = document.getElementById('closeRules');
            }

            setupEventListeners() {
                this.endTurnButton.addEventListener('click', () => this.endTurn());
                this.newGameButton.addEventListener('click', () => this.startNewGame());
                this.clearLogButton.addEventListener('click', () => this.clearLog());
                
                this.helpButton.addEventListener('click', () => this.showRules());
                this.closeRules.addEventListener('click', () => this.hideRules());
                this.rulesModal.addEventListener('click', (e) => {
                    if (e.target === this.rulesModal) {
                        this.hideRules();
                    }
                });
                
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.hideRules();
                    }
                });
            }

            showRules() {
                this.rulesModal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }

            hideRules() {
                this.rulesModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }

            clearLog() {
                this.gameLog.innerHTML = '';
                this.addLogEntry('Лог очищен. Начинаем новую хронику!', 'system');
            }

            startBackgroundRotation() {
                setInterval(() => {
                    this.changeBackground();
                }, 5000);
            }

            changeBackground() {
                this.currentBgIndex = (this.currentBgIndex + 1) % this.backgrounds.length;
                const nextBg = this.backgrounds[this.currentBgIndex];
                
                const tempImg = new Image();
                tempImg.onload = () => {
                    document.body.style.backgroundImage = `url('${nextBg}')`;
                    this.bgIndicator.textContent = `Фон ${this.currentBgIndex + 1}/${this.backgrounds.length}`;
                };
                tempImg.src = nextBg;
            }

            startNewGame() {
                this.player = { hand: [], battlefield: [], mana: 5, maxMana: 5, score: 0 };
                this.computer = { hand: [], battlefield: [], mana: 5, maxMana: 5, score: 0 };
                this.turn = 'player';
                this.round = 1;
                
                this.dealCards();
                this.updateUI();
                this.addLogEntry('🎲 Начинается новая магическая дуэль!', 'system');
            }

            dealCards() {
                for (let i = 0; i < 5; i++) {
                    this.player.hand.push(this.getRandomCard());
                    this.computer.hand.push(this.getRandomCard());
                }
            }

            getRandomCard() {
                const cardType = this.cardTypes[Math.floor(Math.random() * this.cardTypes.length)];
                return {
                    ...cardType,
                    id: Math.random().toString(36).substr(2, 9)
                };
            }

            playCard(card, isPlayer = true) {
                const player = isPlayer ? this.player : this.computer;
                
                if (player.mana >= card.cost) {
                    player.mana -= card.cost;
                    player.battlefield.push(card);
                    player.hand = player.hand.filter(c => c.id !== card.id);
                    
                    this.addLogEntry(`${isPlayer ? '🧙 Игрок' : '🍻 Трактирщик'} разыгрывает ${card.name} ${card.suit} (${card.cost}⚡)`);
                    this.updateUI();
                    this.checkCombinations(isPlayer);
                }
            }

            checkCombinations(isPlayer) {
                const player = isPlayer ? this.player : this.computer;
                const battlefield = player.battlefield;
                
                player.score = battlefield.reduce((sum, card) => sum + card.value, 0);
                
                for (const [comboName, combo] of Object.entries(this.combinations)) {
                    const count = battlefield.filter(card => card.value === combo.value).length;
                    if (count >= combo.cards) {
                        player.score += combo.bonus;
                        this.showCombination(comboName, combo.bonus, isPlayer);
                    }
                }
            }

            showCombination(comboName, bonus, isPlayer) {
                const comboElement = document.createElement('div');
                comboElement.className = 'combination';
                comboElement.textContent = `${comboName} +${bonus}`;
                this.activeCombinations.appendChild(comboElement);
                
                setTimeout(() => {
                    comboElement.remove();
                }, 3000);
                
                this.addLogEntry(`🎴 ${isPlayer ? 'Игрок' : 'Трактирщик'} собирает комбинацию "${comboName}"! +${bonus} очков`);
            }

            endTurn() {
                if (this.turn === 'player') {
                    this.turn = 'computer';
                    this.turnIndicator.textContent = 'Ход трактирщика';
                    this.endTurnButton.disabled = true;
                    
                    this.addLogEntry('➡️ Игрок завершает ход', 'system');
                    
                    setTimeout(() => {
                        this.computerTurn();
                    }, 1000);
                }
            }

            computerTurn() {
                const playableCards = this.computer.hand.filter(card => card.cost <= this.computer.mana);
                
                if (playableCards.length > 0) {
                    const cardToPlay = playableCards.reduce((max, card) => 
                        card.cost > max.cost ? card : max, playableCards[0]);
                    
                    this.playCard(cardToPlay, false);
                    
                    if (this.computer.mana > 0 && this.computer.hand.some(card => card.cost <= this.computer.mana)) {
                        setTimeout(() => this.computerTurn(), 1000);
                    } else {
                        this.endComputerTurn();
                    }
                } else {
                    this.endComputerTurn();
                }
            }

            endComputerTurn() {
                this.addLogEntry('⬅️ Трактирщик завершает ход', 'system');
                this.resolveRound();
            }

            resolveRound() {
                const playerScore = this.player.score;
                const computerScore = this.computer.score;
                
                let roundResult = '';
                if (playerScore > computerScore) {
                    roundResult = `🎉 Игрок выигрывает раунд ${this.round}! (${playerScore} vs ${computerScore})`;
                    this.addLogEntry(roundResult, 'victory');
                } else if (computerScore > playerScore) {
                    roundResult = `💀 Трактирщик выигрывает раунд ${this.round}! (${playerScore} vs ${computerScore})`;
                    this.addLogEntry(roundResult, 'defeat');
                } else {
                    roundResult = `⚖️ Ничья в раунде ${this.round}! (${playerScore} vs ${computerScore})`;
                    this.addLogEntry(roundResult, 'draw');
                }
                
                this.round++;
                this.player.mana = Math.min(this.player.maxMana, this.player.mana + 2);
                this.computer.mana = Math.min(this.computer.maxMana, this.computer.mana + 2);
                
                if (this.player.hand.length < 5) {
                    this.player.hand.push(this.getRandomCard());
                }
                if (this.computer.hand.length < 5) {
                    this.computer.hand.push(this.getRandomCard());
                }
                
                this.turn = 'player';
                this.turnIndicator.textContent = 'Ваш ход';
                this.endTurnButton.disabled = false;
                
                this.updateUI();
            }

            createCardElement(card, isPlayer = true, inHand = true) {
                const cardElement = document.createElement('div');
                cardElement.className = `card ${isPlayer ? 'in-hand' : 'computer'} ${inHand ? '' : 'played'}`;
                cardElement.innerHTML = `
                    <div class="card-cost">${card.cost}⚡</div>
                    <div class="card-value">${card.value}</div>
                    <div class="card-suit">${card.suit}</div>
                    <div style="font-size: 0.6em; text-align: center;">${card.name}</div>
                `;
                
                if (inHand && isPlayer && this.turn === 'player' && this.player.mana >= card.cost) {
                    cardElement.style.cursor = 'pointer';
                    cardElement.addEventListener('click', () => this.playCard(card, true));
                } else {
                    cardElement.style.cursor = 'default';
                }
                
                return cardElement;
            }

            updateUI() {
                this.playerHand.innerHTML = '';
                this.player.hand.forEach(card => {
                    this.playerHand.appendChild(this.createCardElement(card, true, true));
                });
                
                this.playerSide.innerHTML = '';
                this.player.battlefield.forEach(card => {
                    this.playerSide.appendChild(this.createCardElement(card, true, false));
                });
                
                this.computerSide.innerHTML = '';
                this.computer.battlefield.forEach(card => {
                    this.computerSide.appendChild(this.createCardElement(card, false, false));
                });
                
                this.playerScore.textContent = this.player.score;
                this.computerScore.textContent = this.computer.score;
                this.playerManaValue.textContent = `${this.player.mana}/${this.player.maxMana}`;
                this.computerManaValue.textContent = `${this.computer.mana}/${this.computer.maxMana}`;
                
                this.endTurnButton.disabled = this.turn !== 'player';
            }

            addLogEntry(message, type = 'info') {
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                
                let emoji = '';
                switch(type) {
                    case 'victory':
                        emoji = '🎉 ';
                        break;
                    case 'defeat':
                        emoji = '💀 ';
                        break;
                    case 'draw':
                        emoji = '⚖️ ';
                        break;
                    case 'system':
                        emoji = '⚡ ';
                        break;
                    default:
                        emoji = '';
                }
                
                logEntry.textContent = emoji + message;
                
                // ВСТАВЛЯЕМ СООБЩЕНИЕ В САМОЕ НАЧАЛО (ПЕРВЫМ)
                this.gameLog.insertBefore(logEntry, this.gameLog.firstChild);
                
                // Автоскролл к самому верху (к свежему сообщению)
                this.gameLog.parentElement.scrollTop = 0;
                
                // Ограничиваем количество сообщений
                if (this.gameLog.children.length > 15) {
                    this.gameLog.removeChild(this.gameLog.lastChild);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new CardGame();
        });
    </script>
        <div class="audio-footer">
        <audio controls preload="metadata" id="audioPlayer" autoplay>
            <source src="audio/bb4.mp3" type="audio/mpeg">
            Ваш браузер не поддерживает воспроизведение звука.
        </audio>
    </div>
</body>
</html>