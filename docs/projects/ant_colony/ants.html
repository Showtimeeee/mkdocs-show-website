<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="dna" href="ant-icon.png"/>
  <title>–ú—É—Ä–∞–≤—å–∏–Ω–∞—è –ö–æ–ª–æ–Ω–∏—è</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #1b5e20;
      color: white;
      transition: background-color 0.5s;
    }
    .info-panel {
      background: rgba(0, 0, 0, 0.6);
      padding: 15px 30px;
      text-align: center;
      border-bottom: 2px solid #fff3e0;
    }
    .info-panel h2 {
      margin-top: 0;
      font-size: 2em;
    }
    .info-panel p {
      font-size: 1.1em;
      max-width: 800px;
      margin: 0 auto 10px;
    }
    .info-panel strong {
      display: block;
      margin-top: 10px;
    }
    canvas {
      display: block;
      margin: auto;
      background-color: #0a962d;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
      transition: background-color 0.5s;
    }
    .legend {
      text-align: center;
      margin-top: 20px;
    }
    .legend span {
      display: inline-block;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      vertical-align: middle;
      margin-right: 5px;
    }
    .controls {
      margin: 15px 0;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    button {
      padding: 8px 15px;
      background-color: #03570e;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #45a049;
    }
    #day-night-btn {
      background-color: #333;
    }
    #day-night-btn:hover {
      background-color: #555;
    }
    #stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 15px;
      font-size: 0.9em;
    }
    .fact-container {
      margin: 20px auto;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      min-height: 100px;
      max-width: 800px;
      background: rgba(0, 0, 0, 0.3);
    }
    .larva-progress-container {
      width: 100%;
      max-width: 500px;
      margin: 10px auto;
      text-align: center;
    }
    .larva-progress-bar {
      width: 100%;
      height: 20px;
      background-color: #333;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      margin-bottom: 5px;
    }
    .larva-progress-fill {
      height: 100%;
      background-color: #8C2FD4;
      transition: width 0.3s;
    }
    .larva-progress-text {
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="info-panel">
    <h2>–ú—É—Ä–∞–≤—å–∏–Ω–∞—è –ö–æ–ª–æ–Ω–∏—èüêú</h2>
    <p>
      –ò—Å—Å–ª–µ–¥—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–∞—Å—Ç–æ—è—â–µ–π –º—É—Ä–∞–≤—å–∏–Ω–æ–π –∫–æ–ª–æ–Ω–∏–∏. –ú–∞—Ç–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ü–µ–Ω—Ç—Ä–µ, –≤–æ–∫—Ä—É–≥ –Ω–µ—ë ‚Äî –ª–∏—á–∏–Ω–∫–∏ –∏ –∫—É–∫–æ–ª–∫–∏.
      –ù—è–Ω—å–∫–∏ —É—Ö–∞–∂–∏–≤–∞—é—Ç –∑–∞ –ø–æ—Ç–æ–º—Å—Ç–≤–æ–º, —Å–æ–ª–¥–∞—Ç—ã –ø–∞—Ç—Ä—É–ª–∏—Ä—É—é—Ç –ø–µ—Ä–∏–º–µ—Ç—Ä, –∞ —Ñ—É—Ä–∞–∂–∏—Ä—ã —Å–æ–±–∏—Ä–∞—é—Ç –ø–∏—â—É. –ù–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤—Ä–∞–≥–∏ ‚Äî —Ö–∏—â–Ω—ã–µ –Ω–∞—Å–µ–∫–æ–º—ã–µ –∏–ª–∏ –¥—Ä—É–≥–∏–µ –º—É—Ä–∞–≤—å–∏, –∂–µ–ª–∞—é—â–∏–µ —É–∫—Ä–∞—Å—Ç—å –±–µ–∑–∑–∞—â–∏—Ç–Ω—ã—Ö –ª–∏—á–∏–Ω–æ–∫.
    </p>
    <strong id="nest-hp">–ì–Ω–µ–∑–¥–æ: 100%</strong>
    <div class="controls">
      <button id="add-ant-btn">–î–æ–±–∞–≤–∏—Ç—å –º—É—Ä–∞–≤—å—è (—Å–ª—É—á–∞–π–Ω—ã–π —Ç–∏–ø)</button>
      <button id="buy-larva-btn">–ö—É–ø–∏—Ç—å –ª–∏—á–∏–Ω–∫—É (5 –µ–¥—ã)</button>
      <button id="add-enemy-btn">–î–æ–±–∞–≤–∏—Ç—å –≤—Ä–∞–≥–∞</button>
      <button id="day-night-btn">üåô</button>
    </div>
    <div class="larva-progress-container">
      <div class="larva-progress-bar">
        <div class="larva-progress-fill" id="larva-progress-fill"></div>
      </div>
      <div class="larva-progress-text" id="larva-progress-text">–°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—á–∏–Ω–∫–∏: 0%</div>
    </div>
    <div id="stats">
      <div>–ú—É—Ä–∞–≤—å–µ–≤: <span id="ant-count">0</span></div>
      <div>–ü–∞–¥—å: <span id="food-count">0</span></div>
      <div>E–¥—ã –Ω–∞ —Å–∫–ª–∞–¥–µ: <span id="food-collected">0</span></div>
      <div>–õ–∏—á–∏–Ω–æ–∫: <span id="larvae-count">0</span></div>
      <div>–í—Ä–∞–≥–æ–≤: <span id="enemy-count">0</span></div>
      <div>–£–∫—Ä–∞–¥–µ–Ω–æ –ª–∏—á–∏–Ω–æ–∫: <span id="stolen-larvae">0</span></div>
    </div>
  </div>
  <canvas id="colony-canvas" width="900" height="600"></canvas>
  <div class="legend">
    <p><span style="background:#8C2FD4"></span>–ú–∞—Ç–∫–∞</p>
    <p><span style="background:#ffd600;"></span>–ù—è–Ω—å–∫–∞</p>
    <p><span style="background:#fff176;"></span>–§—É—Ä–∞–∂–∏—Ä</p>
    <p><span style="background:#2979ff; border: 1px solid white;"></span>–°–æ–ª–¥–∞—Ç</p>
    <p><span style="background:#f19010;"></span>–°—Ç—Ä–æ–∏—Ç–µ–ª—å</p>
    <p><span style="background:#ffffff;"></span>–õ–∏—á–∏–Ω–∫–∞ / –ö—É–∫–æ–ª–∫–∞</p>
    <p><span style="background:#f44336;"></span>–ü–∞–¥—å</p>
    <p><span style="background:#000000e8; border: 1px solid white;"></span>–í—Ä–∞–≥</p>
    <p><span style="background:#f19010;"></span>–°–∫–ª–∞–¥ –µ–¥—ã</p>
    <p><span style="background:#f19010;"></span>–§–µ—Ä–æ–º–æ–Ω—ã –∫ –≥–Ω–µ–∑–¥—É</p>
    <p><span style="background:#ff0000;"></span>–§–µ—Ä–æ–º–æ–Ω—ã –∫ –µ–¥–µ</p>
    <p><span style="background:#120125;"></span>–§–µ—Ä–æ–º–æ–Ω—ã —Å–æ–ª–¥–∞—Ç</p>
    <p><span style="background:#ffffff;"></span>–§–µ—Ä–æ–º–æ–Ω—ã –≤—Ä–∞–≥–æ–≤</p>
    <p><span style="background:#ffeb3b;"></span>–§–µ—Ä–æ–º–æ–Ω—ã –Ω—è–Ω–µ–∫</p>
  </div>
  <div class="fact-container" id="factDisplay">
    <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç –æ –º—É—Ä–∞–≤—å—è—Ö</p>
  </div>
  <div style="text-align: center; margin-bottom: 20px;">
    <button onclick="showRandomFact()">–ü–æ–ª—É—á–∏—Ç—å —Ñ–∞–∫—Ç –æ –º—É—Ä–∞–≤—å—è—Ö</button>
  </div>
  <script>
    const canvas = document.getElementById('colony-canvas');
    const ctx = canvas.getContext('2d');

    // –¶–µ–Ω—Ç—Ä –≥–Ω–µ–∑–¥–∞
    const NEST_CENTER = { x: 130, y: 300 };
    const NEST = {
      x: NEST_CENTER.x,
      y: NEST_CENTER.y - 20,
      size: 150,
      entranceOffset: 25,
      color: '#8B4513',
      maxHp: 100,
      hp: 100,
      radius: 60
    };

    const LARVAE_RADIUS = 30;
    const STORAGE_POSITION = { x: NEST_CENTER.x - 40, y: NEST_CENTER.y + 40 }; // –†—è–¥–æ–º —Å –ª–∏—á–∏–Ω–∫–∞–º–∏

    const ANT_TYPES = {
      queen: { color: '#8C2FD4', size: 12, speed: 0 },
      nurse: { color: '#ffd600', size: 5, speed: 0.3 },
      forager: { color: '#fff176', size: 6, speed: 0.6 },
      soldier: { color: '#2979ff', size: 9, speed: 0.8 },
      builder: { color: '#4CAF50', size: 7, speed: 0.5 } // –ù–æ–≤—ã–π —Ç–∏–ø: –°—Ç—Ä–æ–∏—Ç–µ–ª—å
    };

    let ants = [];
    let foods = [];
    let pheromones = [];
    let enemies = [];
    let sticks = []; // –ü–∞–ª–æ—á–∫–∏ –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª–µ–π
    const MAX_PHEROMONES = 500;

    let isNight = false;
    let foodCollectedCount = 0;
    let stolenLarvaeCount = 0;
    let enemySpawnTimer = 0;
    let frameCount = 0;
    let larvaSpawnProgress = 0;
    const LARVA_SPAWN_THRESHOLD = 1800;

    function initColony() {
      ants = [];
      foods = [];
      pheromones = [];
      enemies = [];
      sticks = [];

      foodCollectedCount = 0;
      stolenLarvaeCount = 0;
      enemySpawnTimer = 0;
      frameCount = 0;
      larvaSpawnProgress = 0;
      updateLarvaProgressBar();

      NEST.hp = NEST.maxHp;

      // –ú–∞—Ç–∫–∞
      ants.push({
        type: 'queen',
        x: NEST_CENTER.x,
        y: NEST_CENTER.y,
      });

      // –õ–∏—á–∏–Ω–∫–∏ –≤–Ω—É—Ç—Ä–∏ –≥–Ω–µ–∑–¥–∞
      for (let i = 0; i < 11; i++) {
        const angle = (i / 8) * Math.PI * 3;
        ants.push({
          type: 'larva',
          x: NEST_CENTER.x + Math.cos(angle) * LARVAE_RADIUS,
          y: NEST_CENTER.y + Math.sin(angle) * LARVAE_RADIUS,
          size: 6,
          growthTimer: 0,
          growthStage: 0
        });
      }

      // –ù—è–Ω—å–∫–∏
      for (let i = 0; i < 6; i++) {
        ants.push({
          type: 'nurse',
          x: NEST_CENTER.x + Math.random() * 60 - 30,
          y: NEST_CENTER.y + Math.random() * 60 - 30,
          vx: (Math.random() - 0.5) * 1,
          vy: (Math.random() - 0.5) * 1,
        });
      }

      // –°–æ–ª–¥–∞—Ç—ã
      for (let i = 0; i < 4; i++) {
        ants.push({
          type: 'soldier',
          x: NEST_CENTER.x + 60 + Math.random() * 200,
          y: NEST_CENTER.y + Math.random() * 200 - 100,
          vx: (Math.random() - 0.5) * 1,
          vy: (Math.random() - 0.5) * 1,
          pauseTimer: 0,
          isPaused: false
        });
      }

      // –§—É—Ä–∞–∂–∏—Ä—ã
      for (let i = 0; i < 5; i++) {
        ants.push({
          type: 'forager',
          x: NEST_CENTER.x + 150 + Math.random() * 400,
          y: NEST_CENTER.y + Math.random() * 300 - 150,
          vx: (Math.random() - 0.5) * 1,
          vy: (Math.random() - 0.5) * 1,
          carryingFood: false,
        });
      }

      // –°—Ç—Ä–æ–∏—Ç–µ–ª–∏
      for (let i = 0; i < 3; i++) {
        ants.push({
          type: 'builder',
          x: NEST_CENTER.x + 150 + Math.random() * 400,
          y: NEST_CENTER.y + Math.random() * 300 - 150,
          vx: (Math.random() - 0.5) * 1,
          vy: (Math.random() - 0.5) * 1,
          carryingStick: false
        });
      }

      // –ï–¥–∞
      for (let i = 0; i < 9; i++) {
        foods.push({
          x: 400 + Math.random() * 400,
          y: 100 + Math.random() * 400,
          collected: false,
        });
      }

      // –ü–∞–ª–æ—á–∫–∏
      for (let i = 0; i < 15; i++) {
        sticks.push({
          x: 100 + Math.random() * 700,
          y: 50 + Math.random() * 500,
          collected: false
        });
      }
    }

    function updateLarvaProgressBar() {
      const progressPercent = Math.min(100, (larvaSpawnProgress / LARVA_SPAWN_THRESHOLD) * 100);
      document.getElementById('larva-progress-fill').style.width = `${progressPercent}%`;
      document.getElementById('larva-progress-text').textContent = `–°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—á–∏–Ω–∫–∏: ${Math.floor(progressPercent)}%`;
    }

    function drawNest() {
      if (NEST.hp <= 0) return;

      ctx.beginPath();
      const height = Math.sqrt(3) / 2 * NEST.size;
      const points = [
        { x: NEST.x, y: NEST.y - height / 2 },
        { x: NEST.x - NEST.size / 2, y: NEST.y + height / 2 },
        { x: NEST.x + NEST.size / 2, y: NEST.y + height / 2 }
      ];
      ctx.moveTo(points[0].x, points[0].y);
      ctx.lineTo(points[1].x, points[1].y);
      ctx.lineTo(points[2].x, points[2].y);
      ctx.closePath();
      ctx.fillStyle = NEST.color;
      ctx.fill();

      ctx.fillStyle = '#2f2f2f';
      ctx.fillRect(
        NEST.x - 5,
        NEST.y - NEST.entranceOffset,
        10,
        NEST.entranceOffset + 5
      );

      const hpPercent = (NEST.hp / NEST.maxHp) * 100;
      const status = document.getElementById('nest-hp');
      status.textContent = `–ì–Ω–µ–∑–¥–æ: ${Math.round(hpPercent)}% HP`;
      if (hpPercent <= 0) {
        status.style.color = 'red';
        status.textContent += " ‚Äî –ì–Ω–µ–∑–¥–æ —Ä–∞–∑—Ä—É—à–µ–Ω–æ!";
      } else if (hpPercent <= 30) {
        status.style.color = 'orange';
      } else {
        status.style.color = 'white';
      }
    }

    function drawAnts() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (NEST.hp > 0) {
        drawNest();
      }

      pheromones.forEach(p => {
        ctx.beginPath();
        ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
        if (p.type === 'toNest') {
          ctx.fillStyle = '#f19010';
        } else if (p.type === 'toFood') {
          ctx.fillStyle = 'rgba(255,0,0,0.3)';
        } else if (p.type === 'soldier') {
          ctx.fillStyle = '#120125';
        } else if (p.type === 'enemy') {
          ctx.fillStyle = 'rgba(255,255,255,0.3)';
        } else if (p.type === 'nurse') {
          ctx.fillStyle = '#ffeb3b';
        }
        ctx.fill();
      });

      // –ï–¥–∞
      foods.forEach(food => {
        if (!food.collected) {
          ctx.beginPath();
          ctx.arc(food.x, food.y, 5, 0, Math.PI * 2);
          ctx.fillStyle = '#f44336';
          ctx.fill();
        }
      });

      // –ü–∞–ª–æ—á–∫–∏
      sticks.forEach(stick => {
        if (!stick.collected) {
          ctx.beginPath();
          ctx.rect(stick.x, stick.y, 4, 4);
          ctx.fillStyle = '#f19010';
          ctx.fill();
        }
      });

      // –°–∫–ª–∞–¥ –µ–¥—ã
      const storageCount = Math.min(foodCollectedCount, 50);
      if (storageCount > 0) {
        for (let i = 0; i < storageCount; i++) {
          const angle = (i * 137.5) * (Math.PI / 180);
          const radius = Math.sqrt(i) * 2;
          ctx.beginPath();
          ctx.arc(
            STORAGE_POSITION.x + Math.cos(angle) * radius,
            STORAGE_POSITION.y + Math.sin(angle) * radius,
            3, 0, Math.PI * 2
          );
          ctx.fillStyle = '#f44336'; // –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç, –∫–∞–∫ —É –ø–∞–¥–∏
          ctx.fill();
        }
      }

      // –í—Ä–∞–≥–∏
      enemies.forEach(enemy => {
        ctx.beginPath();
        ctx.arc(enemy.x, enemy.y, 8, 0, Math.PI * 2);
        ctx.fillStyle = '#000000';
        ctx.fill();
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 2;
        ctx.stroke();
        if (enemy.carryingLarva) {
          ctx.beginPath();
          ctx.arc(enemy.x, enemy.y - 12, 5, 0, Math.PI * 2);
          ctx.fillStyle = '#ffffff';
          ctx.fill();
        }
      });

      // –ú—É—Ä–∞–≤—å–∏
      ants.forEach(ant => {
        const data = ANT_TYPES[ant.type];
        if (data) {
          ctx.beginPath();
          ctx.arc(ant.x, ant.y, data.size, 0, Math.PI * 2);
          ctx.fillStyle = data.color;
          ctx.fill();
          ctx.strokeStyle = 'white';
          ctx.lineWidth = 1;
          ctx.stroke();
          if (ant.type === 'forager' && ant.carryingFood) {
            ctx.beginPath();
            ctx.arc(ant.x, ant.y - 10, 3, 0, Math.PI * 2);
            ctx.fillStyle = '#f44336';
            ctx.fill();
          }
        }
      });

      // –õ–∏—á–∏–Ω–∫–∏
      ants.forEach(ant => {
        if (ant.type === 'larva') {
          ctx.beginPath();
          ctx.arc(ant.x, ant.y, ant.size, 0, Math.PI * 2);
          ctx.fillStyle = '#ffffff';
          ctx.fill();
          ctx.strokeStyle = 'rgba(0,0,0,0.3)';
          ctx.lineWidth = 1;
          ctx.stroke();
        }
      });
    }

    function updatePositions() {
      frameCount++;
      document.getElementById('ant-count').textContent = ants.filter(a => a.type !== 'larva').length;
      document.getElementById('larvae-count').textContent = ants.filter(a => a.type === 'larva').length;
      document.getElementById('food-count').textContent = foods.filter(f => !f.collected).length;
      document.getElementById('food-collected').textContent = foodCollectedCount;
      document.getElementById('enemy-count').textContent = enemies.length;
      document.getElementById('stolen-larvae').textContent = stolenLarvaeCount;

      pheromones.forEach(p => p.life--);
      pheromones = pheromones.filter(p => p.life > 0);

      if (foodCollectedCount > 0) {
        larvaSpawnProgress++;
        if (larvaSpawnProgress >= LARVA_SPAWN_THRESHOLD) {
          larvaSpawnProgress = 0;
          const larvaeCount = ants.filter(a => a.type === 'larva').length;
          if (larvaeCount < 15) {
            const angle = Math.random() * Math.PI * 2;
            ants.push({
              type: 'larva',
              x: NEST_CENTER.x + Math.cos(angle) * LARVAE_RADIUS,
              y: NEST_CENTER.y + Math.sin(angle) * LARVAE_RADIUS,
              size: 6,
              growthTimer: 0,
              growthStage: 0
            });
            foodCollectedCount = Math.max(0, foodCollectedCount - 1);
          }
        }
      } else {
        larvaSpawnProgress = 0;
      }

      updateLarvaProgressBar();

      enemySpawnTimer++;
      if (enemySpawnTimer > 300 && Math.random() < 0.01 && enemies.length < 5) {
        spawnEnemy();
        enemySpawnTimer = 0;
      }

      enemies.forEach(enemy => {
        if (enemy.carryingLarva) {
          let dx = enemy.spawnX - enemy.x;
          let dy = enemy.spawnY - enemy.y;
          let dist = Math.hypot(dx, dy);
          if (dist < 10) {
            const index = enemies.indexOf(enemy);
            enemies.splice(index, 1);
            stolenLarvaeCount++;
          } else {
            enemy.vx = dx / dist * 1.2 * enemy.speedMultiplier;
            enemy.vy = dy / dist * 1.2 * enemy.speedMultiplier;
          }
        } else {
          if (NEST.hp > 0) {
            let dx = NEST.x - enemy.x;
            let dy = NEST.y - enemy.y;
            let dist = Math.hypot(dx, dy);
            if (dist < NEST.radius) {
              NEST.hp -= 2; // –£—Ä–æ–Ω –ø–æ –≥–Ω–µ–∑–¥—É
              if (NEST.hp < 0) NEST.hp = 0;
              const index = enemies.indexOf(enemy);
              enemies.splice(index, 1); // –í—Ä–∞–≥ —É–º–∏—Ä–∞–µ—Ç
            } else {
              enemy.vx += dx / dist * 0.05 * enemy.speedMultiplier;
              enemy.vy += dy / dist * 0.05 * enemy.speedMultiplier;
            }
          } else {
            const larvae = ants.filter(a => a.type === 'larva');
            if (larvae.length > 0) {
              let closestLarva = null;
              let minDist = Infinity;
              larvae.forEach(larva => {
                const dist = Math.hypot(larva.x - enemy.x, larva.y - enemy.y);
                if (dist < minDist) {
                  minDist = dist;
                  closestLarva = larva;
                }
              });
              if (closestLarva) {
                let dx = closestLarva.x - enemy.x;
                let dy = closestLarva.y - enemy.y;
                let dist = Math.hypot(dx, dy);
                if (dist < 10) {
                  enemy.carryingLarva = true;
                  const index = ants.indexOf(closestLarva);
                  ants.splice(index, 1);
                } else {
                  enemy.vx += dx / dist * 0.05 * enemy.speedMultiplier;
                  enemy.vy += dy / dist * 0.05 * enemy.speedMultiplier;
                }
              }
            }
          }
        }

        const baseMaxSpeed = enemy.carryingLarva ? 1.2 : 0.8;
        const maxSpeed = baseMaxSpeed * enemy.speedMultiplier;
        const speed = Math.hypot(enemy.vx, enemy.vy);
        if (speed > maxSpeed) {
          enemy.vx = (enemy.vx / speed) * maxSpeed;
          enemy.vy = (enemy.vy / speed) * maxSpeed;
        }
        enemy.x += enemy.vx;
        enemy.y += enemy.vy;
      });

      ants.forEach(ant => {
        if (ant.type === 'queen') return;

        if (ant.type === 'larva') {
          ant.growthTimer++;
          if (ant.growthTimer % 200 === 0 && ant.growthStage < 100) {
            ant.growthStage += 2 + Math.random() * 5;
            ant.size = 6 + (ant.growthStage / 25);
          }
          if (ant.growthStage >= 100) {
            const types = ['nurse', 'forager', 'soldier', 'builder'];
            const type = types[Math.floor(Math.random() * types.length)];
            const index = ants.indexOf(ant);
            ants.splice(index, 1, {
              type: type,
              x: ant.x,
              y: ant.y,
              vx: (Math.random() - 0.5) * 1,
              vy: (Math.random() - 0.5) * 1,
              ...(type === 'forager' ? { carryingFood: false } : {}),
              ...(type === 'soldier' ? { pauseTimer: 0, isPaused: false } : {}),
              ...(type === 'builder' ? { carryingStick: false } : {})
            });
            if (Math.random() < 0.25) {
              const angle = Math.random() * Math.PI * 2;
              ants.push({
                type: 'larva',
                x: NEST_CENTER.x + Math.cos(angle) * LARVAE_RADIUS,
                y: NEST_CENTER.y + Math.sin(angle) * LARVAE_RADIUS,
                size: 6,
                growthTimer: 0,
                growthStage: 0
              });
            }
          }
          return;
        }

        // –°—Ç—Ä–æ–∏—Ç–µ–ª—å
        if (ant.type === 'builder') {
          let closestStick = sticks.find(s => !s.collected);
          if (closestStick) {
            let dx = closestStick.x - ant.x;
            let dy = closestStick.y - ant.y;
            let dist = Math.hypot(dx, dy);
            if (dist < 10) {
              closestStick.collected = true;
              ant.carryingStick = true;
            } else {
              ant.vx += dx / dist * 0.03;
              ant.vy += dy / dist * 0.03;
            }
          } else if (ant.carryingStick && NEST.hp < NEST.maxHp) {
            let dx = NEST.x - ant.x;
            let dy = NEST.y - ant.y;
            let dist = Math.hypot(dx, dy);
            if (dist < 10) {
              NEST.hp += 5;
              if (NEST.hp > NEST.maxHp) NEST.hp = NEST.maxHp;
              ant.carryingStick = false;
            } else {
              ant.vx += dx / dist * 0.02;
              ant.vy += dy / dist * 0.02;
            }
          }
        }

        // –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –ø–æ–≤–µ–¥–µ–Ω–∏—è –º—É—Ä–∞–≤—å—ë–≤...
        if (ant.type === 'nurse') {
          const larvae = ants.filter(a => a.type === 'larva');
          if (larvae.length > 0) {
            const targetLarva = larvae[Math.floor(Math.random() * larvae.length)];
            let dx = targetLarva.x - ant.x;
            let dy = targetLarva.y - ant.y;
            let dist = Math.hypot(dx, dy);
            if (dist > 10) {
              ant.vx += dx / dist * 0.03;
              ant.vy += dy / dist * 0.03;
            }
            if (Math.random() < 0.1) {
              pheromones.push({
                x: ant.x,
                y: ant.y,
                type: 'nurse',
                life: 100
              });
              if (pheromones.length > MAX_PHEROMONES) {
                pheromones.shift();
              }
            }
          }
        }

        if (ant.type === 'soldier') {
          if (!ant.isPaused) {
            let closestEnemy = null;
            let minDist = Infinity;
            enemies.forEach(e => {
              const dist = Math.hypot(e.x - ant.x, e.y - ant.y);
              if (dist < 100 && dist < minDist) {
                minDist = dist;
                closestEnemy = e;
              }
            });
            if (closestEnemy) {
              let dx = closestEnemy.x - ant.x;
              let dy = closestEnemy.y - ant.y;
              let dist = Math.hypot(dx, dy);
              if (dist < 10) {
                const index = enemies.indexOf(closestEnemy);
                enemies.splice(index, 1);
                for (let i = 0; i < 2; i++) {
                  foods.push({
                    x: closestEnemy.x + (Math.random() * 20 - 10),
                    y: closestEnemy.y + (Math.random() * 20 - 10),
                    collected: false
                  });
                }
              } else {
                ant.vx += dx / dist * 0.05;
                ant.vy += dy / dist * 0.05;
              }
            } else {
              let dx = NEST_CENTER.x - ant.x;
              let dy = NEST_CENTER.y - ant.y;
              let dist = Math.hypot(dx, dy);
              if (dist < 80) {
                ant.vx -= dx / dist * 0.02;
                ant.vy -= dy / dist * 0.02;
              } else if (dist > 200) {
                ant.vx += dx / dist * 0.02;
                ant.vy += dy / dist * 0.02;
              }
            }
            if (Math.random() < 0.005 && !ant.isPaused) {
              ant.isPaused = true;
              ant.pauseTimer = Date.now();
            }
          } else {
            if (Date.now() - ant.pauseTimer > 4000) {
              ant.isPaused = false;
            }
          }
        }

        if (ant.type === 'forager') {
          if (ant.carryingFood) {
            let dx = STORAGE_POSITION.x - ant.x;
            let dy = STORAGE_POSITION.y - ant.y;
            let dist = Math.hypot(dx, dy);
            if (dist < 10) {
              ant.carryingFood = false;
              foodCollectedCount++;
            } else {
              ant.vx += dx / dist * 0.02;
              ant.vy += dy / dist * 0.02;
            }
            if (Math.random() < 0.1) {
              pheromones.push({
                x: ant.x,
                y: ant.y,
                type: 'toNest',
                life: 100
              });
              if (pheromones.length > MAX_PHEROMONES) {
                pheromones.shift();
              }
            }
          } else {
            let nearestFood = foods.find(f => !f.collected);
            if (nearestFood) {
              let dx = nearestFood.x - ant.x;
              let dy = nearestFood.y - ant.y;
              let dist = Math.hypot(dx, dy);
              if (dist < 10) {
                nearestFood.collected = true;
                ant.carryingFood = true;
              } else {
                ant.vx += dx / dist * 0.02;
                ant.vy += dy / dist * 0.02;
              }
              if (Math.random() < 0.1) {
                pheromones.push({
                  x: ant.x,
                  y: ant.y,
                  type: 'toFood',
                  life: 100
                });
                if (pheromones.length > MAX_PHEROMONES) {
                  pheromones.shift();
                }
              }
            }
          }
        }

        ant.x += ant.vx;
        ant.y += ant.vy;
        if (ant.x < 0 || ant.x > canvas.width) ant.vx *= -1;
        if (ant.y < 0 || ant.y > canvas.height) ant.vy *= -1;

        ant.vx += (Math.random() - 0.5) * 0.05;
        ant.vy += (Math.random() - 0.5) * 0.05;

        const speed = Math.hypot(ant.vx, ant.vy);
        const maxSpeed = ANT_TYPES[ant.type]?.speed || 1;
        if (speed > maxSpeed) {
          ant.vx = (ant.vx / speed) * maxSpeed;
          ant.vy = (ant.vy / speed) * maxSpeed;
        }
      });
    }

    function spawnEnemy() {
      const x = canvas.width + 10;
      const y = 50 + Math.random() * (canvas.height - 100);
      const speedMultiplier = 0.3 + Math.random() * 0.6;
      enemies.push({
        x: x,
        y: y,
        spawnX: x,
        spawnY: y,
        vx: -0.3 * speedMultiplier,
        vy: (Math.random() - 0.5) * 0.2 * speedMultiplier,
        carryingLarva: false,
        speedMultiplier: speedMultiplier
      });
    }

    function animate() {
      drawAnts();
      updatePositions();
      requestAnimationFrame(animate);
    }

    function buyLarva() {
      if (foodCollectedCount >= 5 && NEST.hp > 0) {
        foodCollectedCount -= 5;
        const angle = Math.random() * Math.PI * 2;
        ants.push({
          type: 'larva',
          x: NEST_CENTER.x + Math.cos(angle) * LARVAE_RADIUS,
          y: NEST_CENTER.y + Math.sin(angle) * LARVAE_RADIUS,
          size: 6,
          growthTimer: 0,
          growthStage: 0
        });
      }
    }

    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
    initColony();
    animate();

    // --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π ---
    document.getElementById('add-ant-btn').addEventListener('click', () => {
      if (NEST.hp > 0) {
        const types = ['nurse', 'forager', 'soldier', 'builder'];
        const type = types[Math.floor(Math.random() * types.length)];
        ants.push({
          type: type,
          x: NEST_CENTER.x + Math.random() * 300 - 150,
          y: NEST_CENTER.y + Math.random() * 300 - 150,
          vx: (Math.random() - 0.5) * 1,
          vy: (Math.random() - 0.5) * 1,
          ...(type === 'forager' ? { carryingFood: false } : {}),
          ...(type === 'soldier' ? { pauseTimer: 0, isPaused: false } : {}),
          ...(type === 'builder' ? { carryingStick: false } : {})
        });
      }
    });

    document.getElementById('day-night-btn').addEventListener('click', () => {
      isNight = !isNight;
      document.body.style.backgroundColor = isNight ? '#0a1e0d' : '#1b5e20';
      canvas.style.backgroundColor = isNight ? '#1b5e20' : '#388e3c';
      document.getElementById('day-night-btn').textContent = isNight ? 'üåû' : 'üåô';
    });

    document.getElementById('add-enemy-btn').addEventListener('click', spawnEnemy);
    document.getElementById('buy-larva-btn').addEventListener('click', buyLarva);

    // --- –§–∞–∫—Ç—ã –æ –º—É—Ä–∞–≤—å—è—Ö ---
    const antFacts = [
      "–ú—É—Ä–∞–≤—å–∏ –æ–±—â–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é —Ñ–µ—Ä–æ–º–æ–Ω–æ–≤, –æ—Å—Ç–∞–≤–ª—è—è –∑–∞–ø–∞—Ö–æ–≤—ã–µ —Å–ª–µ–¥—ã –¥–ª—è —Å–æ—Ä–æ–¥–∏—á–µ–π.",
      "–°—É—â–µ—Å—Ç–≤—É–µ—Ç –±–æ–ª–µ–µ 15 000 –≤–∏–¥–æ–≤ –º—É—Ä–∞–≤—å—ë–≤ (–∞ –ø–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–º –æ—Ü–µ–Ω–∫–∞–º ‚Äì –¥–æ 20 000). –û–Ω–∏ –∂–∏–≤—É—Ç –ø–æ—á—Ç–∏ –Ω–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∞—Ö, –∫—Ä–æ–º–µ –ê–Ω—Ç–∞—Ä–∫—Ç–∏–¥—ã.",
      "–ú—É—Ä–∞–≤—å–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –æ–∫–æ–ª–æ 140‚Äì160 –º–ª–Ω –ª–µ—Ç –Ω–∞–∑–∞–¥ –∏ –ø–µ—Ä–µ–∂–∏–ª–∏ –¥–∏–Ω–æ–∑–∞–≤—Ä–æ–≤, –∞–¥–∞–ø—Ç–∏—Ä—É—è—Å—å –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –∫–ª–∏–º–∞—Ç–∞.",
      "–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–∏–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º—É—Ä–∞–≤—å–∏-–∞–º–∞–∑–æ–Ω–∫–∏) –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –ª–∏—á–∏–Ω–∫–∏ –¥—Ä—É–≥–∏—Ö –º—É—Ä–∞–≤—å—ë–≤ –∏ –∑–∞—Å—Ç–∞–≤–ª—è—é—Ç –∏—Ö —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —Å–µ–±—è.",
      "–ú—É—Ä–∞–≤—å–∏ —Å–æ–∑–¥–∞—é—Ç —Å–ª–æ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã —Ç–æ–Ω–Ω–µ–ª–µ–π —Å –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–µ–π, —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º–∏ –ø–∏—â–∏ –∏ –¥–∞–∂–µ '—Ñ–µ—Ä–º–∞–º–∏' –¥–ª—è –≥—Ä–∏–±–æ–≤ (–∫–∞–∫ –ª–∏—Å—Ç–æ—Ä–µ–∑—ã).",
      "–£ –≤–∏–¥–∞ Camponotus saundersi –µ—Å—Ç—å —Ä–∞–±–æ—á–∏–µ —Å –≤–∑—Ä—ã–≤–∞—é—â–∏–º–∏—Å—è –∂–µ–ª–µ–∑–∞–º–∏ ‚Äì –ø—Ä–∏ —É–≥—Ä–æ–∑–µ –æ–Ω–∏ —Ä–∞–∑—Ä—ã–≤–∞—é—Ç —Å–µ–±—è, –≤—ã–ø—É—Å–∫–∞—è —è–¥.",
      "–†–µ–∫–æ—Ä–¥–Ω—ã–π –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–π –º—É—Ä–∞–≤–µ–π–Ω–∏–∫ –∏–º–µ–ª –≥–ª—É–±–∏–Ω—É –±–æ–ª–µ–µ 8 –º–µ—Ç—Ä–æ–≤ –∏ –∑–∞–Ω–∏–º–∞–ª –ø–ª–æ—â–∞–¥—å –æ–∫–æ–ª–æ 50 –º¬≤.",
      "–ú—É—Ä–∞–≤—å–∏ –º–æ–≥—É—Ç –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –≥—Ä—É–∑—ã –≤ 10-50 —Ä–∞–∑ —Ç—è–∂–µ–ª–µ–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤–µ—Å–∞.",
      "–£ –º—É—Ä–∞–≤—å—ë–≤ –Ω–µ—Ç –ª—ë–≥–∫–∏—Ö ‚Äì –æ–Ω–∏ –¥—ã—à–∞—Ç —á–µ—Ä–µ–∑ –∫—Ä–æ—à–µ—á–Ω—ã–µ –æ—Ç–≤–µ—Ä—Å—Ç–∏—è (–¥—ã—Ö–∞–ª—å—Ü–∞).",
      "–ú—É—Ä–∞–≤–µ–π–Ω–∏–∫ ‚Äì —ç—Ç–æ –µ–¥–∏–Ω—ã–π '—Å–≤–µ—Ä—Ö–æ—Ä–≥–∞–Ω–∏–∑–º', –≥–¥–µ –∫–∞–∂–¥—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–≤–æ—é —Ä–æ–ª—å: —Ä–∞–±–æ—á–∏–µ, —Å–æ–ª–¥–∞—Ç—ã, –∫–æ—Ä–æ–ª–µ–≤–∞."
    ];

    function showRandomFact() {
      const randomIndex = Math.floor(Math.random() * antFacts.length);
      document.getElementById('factDisplay').innerHTML = `<p>${antFacts[randomIndex]}</p>`;
    }
  </script>
</body>
<footer>
  <p>Copyright ¬© 2025 Vadim.</p>
</footer>
</html>
