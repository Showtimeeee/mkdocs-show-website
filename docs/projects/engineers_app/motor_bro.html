<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='50' y='80' font-size='80' text-anchor='middle'>üèçÔ∏è</text></svg>">
    <title>–°–∏–º—É–ª—è—Ç–æ—Ä –¥–≤–∏–≥–∞—Ç–µ–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–≥–æ—Ä–∞–Ω–∏—è</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #121212;
            color: #e0e0e0;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 1000px;
            margin: 0 auto;
        }
        canvas {
            background-color: #252525;
            border-radius: 8px;
            margin-top: 20px;
        }
        .controls {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            width: 100%;
        }
        button, .slider-container {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
        }
        button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }
        .slider-container {
            padding: 15px;
            background-color: #1e1e1e;
            border-radius: 8px;
            min-width: 250px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #1e1e1e;
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            border: 1px solid #444;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #333;
        }
        .engine-block {
            position: relative;
            margin-bottom: 20px;
        }
        .spark {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: yellow;
            border-radius: 50%;
            opacity: 0;
        }
        .valve {
            position: absolute;
            width: 20px;
            height: 10px;
            background-color: #888;
            border-radius: 5px 5px 0 0;
        }
        .flywheel-mark {
            position: absolute;
            width: 5px;
            height: 15px;
            background-color: yellow;
        }
    </style>
</head>
<body>
    <h1>–°–∏–º—É–ª—è—Ç–æ—Ä 4-—Ü–∏–ª–∏–Ω–¥—Ä–æ–≤–æ–≥–æ –î–í–°</h1>
    <div class="container">
        <div class="engine-block">
            <canvas id="engineCanvas" width="900" height="600"></canvas>
            <div class="spark" id="spark1"></div>
            <div class="spark" id="spark2"></div>
            <div class="spark" id="spark3"></div>
            <div class="spark" id="spark4"></div>
        </div>
        <div class="controls">
            <div class="slider-container">
                <label for="speedControl">–°–∫–æ—Ä–æ—Å—Ç—å (–æ–±/–º–∏–Ω):</label>
                <input type="range" id="speedControl" min="100" max="5000" value="1500">
                <span id="speedValue">1500</span>
            </div>
            <button id="startBtn">‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç</button>
            <button id="stopBtn">‚èπÔ∏è –°—Ç–æ–ø</button>
            <button id="resetBtn">üîÑ –°–±—Ä–æ—Å</button>
        </div>
        <table id="engineParams">
            <thead>
                <tr>
                    <th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th>
                    <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>–û–±–æ—Ä–æ—Ç—ã –¥–≤–∏–≥–∞—Ç–µ–ª—è</td>
                    <td id="engineRPM">1500 –æ–±/–º–∏–Ω</td>
                </tr>
                <tr>
                    <td>–¢–∞–∫—Ç</td>
                    <td id="engineCycle">–í–ø—É—Å–∫</td>
                </tr>
                <tr>
                    <td>–£–≥–æ–ª –∫–æ–ª–µ–Ω–≤–∞–ª–∞</td>
                    <td id="crankshaftAngle">0¬∞</td>
                </tr>
                <tr>
                    <td>–ü–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Ä—à–Ω—è</td>
                    <td id="pistonPosition">0 –º–º</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        const canvas = document.getElementById('engineCanvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const resetBtn = document.getElementById('resetBtn');
        const speedControl = document.getElementById('speedControl');
        const speedValue = document.getElementById('speedValue');

        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏—Å–∫—Ä—ã
        const spark1 = document.getElementById('spark1');
        const spark2 = document.getElementById('spark2');
        const spark3 = document.getElementById('spark3');
        const spark4 = document.getElementById('spark4');

        let animationId = null;
        let isRunning = false;
        let engineTime = 0;
        let currentCycle = 0; // 0-–≤–ø—É—Å–∫, 1-—Å–∂–∞—Ç–∏–µ, 2-—Ä–∞–±–æ—á–∏–π —Ö–æ–¥, 3-–≤—ã–ø—É—Å–∫
        const cycles = ["–í–ø—É—Å–∫", "–°–∂–∞—Ç–∏–µ", "–†–∞–±–æ—á–∏–π —Ö–æ–¥", "–í—ã–ø—É—Å–∫"];

        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–≤–∏–≥–∞—Ç–µ–ª—è
        const engine = {
            cylinders: 4,
            bore: 80,       // –î–∏–∞–º–µ—Ç—Ä —Ü–∏–ª–∏–Ω–¥—Ä–∞ (–º–º)
            stroke: 90,      // –•–æ–¥ –ø–æ—Ä—à–Ω—è (–º–º)
            connectingRod: 150, // –î–ª–∏–Ω–∞ —à–∞—Ç—É–Ω–∞ (–º–º)
            rpm: 1500,       // –û–±–æ—Ä–æ—Ç—ã –≤ –º–∏–Ω—É—Ç—É
            maxRpm: 5000,
            angle: 0,       // –£–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞ –∫–æ–ª–µ–Ω–≤–∞–ª–∞ (—Ä–∞–¥)
            pistons: [],
            valves: [],
            flywheelAngle: 0
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ü–∏–ª–∏–Ω–¥—Ä–æ–≤
        function initEngine() {
            engine.pistons = [];
            engine.valves = [];
            
            for (let i = 0; i < engine.cylinders; i++) {
                engine.pistons.push({
                    x: 150 + i * 200,
                    y: 200,
                    width: engine.bore,
                    height: 40,
                    position: 0,
                    cycle: (i * 2) % 4 // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∞–∫—Ç–æ–≤ –ø–æ —Ü–∏–ª–∏–Ω–¥—Ä–∞–º
                });
                
                engine.valves.push({
                    x: 150 + i * 200 - 30,
                    y: 150,
                    open: false,
                    type: 'intake' // –í–ø—É—Å–∫–Ω–æ–π
                }, {
                    x: 150 + i * 200 + engine.bore + 10,
                    y: 150,
                    open: false,
                    type: 'exhaust' // –í—ã–ø—É—Å–∫–Ω–æ–π
                });
            }
        }

        // –†–∏—Å–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞ —Ü–∏–ª–∏–Ω–¥—Ä–æ–≤
        function drawEngineBlock() {
            ctx.fillStyle = '#333';
            ctx.fillRect(100, 100, 700, 350);
            
            // –†–∏—Å—É–µ–º —Ü–∏–ª–∏–Ω–¥—Ä—ã
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 2;
            for (let i = 0; i < engine.cylinders; i++) {
                const piston = engine.pistons[i];
                ctx.strokeRect(piston.x - 10, 120, piston.width + 20, 300);
            }
        }

        // –†–∏—Å–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—à–Ω–µ–π
        function drawPistons() {
            for (let i = 0; i < engine.pistons.length; i++) {
                const piston = engine.pistons[i];
                
                // –ü–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Ä—à–Ω—è
                const crankRadius = engine.stroke / 2;
                const angle = engine.angle + (i * Math.PI); // –°–º–µ—â–µ–Ω–∏–µ —Ñ–∞–∑ –Ω–∞ 180¬∞ –¥–ª—è 4-—Ü–∏–ª–∏–Ω–¥—Ä–æ–≤–æ–≥–æ
                
                piston.position = Math.cos(angle) * crankRadius;
                piston.y = 200 + piston.position;
                
                // –†–∏—Å—É–µ–º –ø–æ—Ä—à–µ–Ω—å
                ctx.fillStyle = '#4CAF50';
                ctx.fillRect(piston.x, piston.y, piston.width, piston.height);
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —Ç–∞–∫—Ç
                piston.cycle = Math.floor((engine.angle / Math.PI * 2 + i) % 4);
            }
        }

        // –†–∏—Å–æ–≤–∞–Ω–∏–µ –∫–æ–ª–µ–Ω—á–∞—Ç–æ–≥–æ –≤–∞–ª–∞
        function drawCrankshaft() {
            ctx.fillStyle = '#f44336';
            ctx.beginPath();
            ctx.arc(450, 400, 40, 0, Math.PI * 2);
            ctx.fill();
            
            // –®–∞—Ç—É–Ω–Ω—ã–µ —à–µ–π–∫–∏
            for (let i = 0; i < engine.cylinders; i++) {
                const angle = engine.angle + (i * Math.PI);
                const x = 450 + Math.cos(angle) * 100;
                const y = 400 + Math.sin(angle) * 100;
                
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, Math.PI * 2);
                ctx.fill();
                
                // –®–∞—Ç—É–Ω—ã
                const piston = engine.pistons[i];
                ctx.strokeStyle = '#2196F3';
                ctx.lineWidth = 6;
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineTo(piston.x + piston.width/2, piston.y);
                ctx.stroke();
            }
        }

        // –†–∏—Å–æ–≤–∞–Ω–∏–µ –º–∞—Ö–æ–≤–∏–∫–∞
        function drawFlywheel() {
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 10;
            ctx.beginPath();
            ctx.arc(450, 400, 80, 0, Math.PI * 2);
            ctx.stroke();
            
            // –ú–µ—Ç–∫–∞ –Ω–∞ –º–∞—Ö–æ–≤–∏–∫–µ
            ctx.save();
            ctx.translate(450, 400);
            ctx.rotate(engine.flywheelAngle);
            ctx.fillStyle = 'yellow';
            ctx.fillRect(70, -5, 10, 10);
            ctx.restore();
        }

        // –†–∏—Å–æ–≤–∞–Ω–∏–µ –∫–ª–∞–ø–∞–Ω–æ–≤
        function drawValves() {
            for (let i = 0; i < engine.valves.length; i++) {
                const valve = engine.valves[i];
                const pistonIdx = Math.floor(i / 2);
                const piston = engine.pistons[pistonIdx];
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞–ø–∞–Ω–∞–º–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∞–∫—Ç–∞
                if (piston.cycle === 0 && valve.type === 'intake') {
                    valve.open = true; // –í–ø—É—Å–∫–Ω–æ–π –æ—Ç–∫—Ä—ã—Ç –Ω–∞ —Ç–∞–∫—Ç–µ –≤–ø—É—Å–∫–∞
                } else if (piston.cycle === 3 && valve.type === 'exhaust') {
                    valve.open = true; // –í—ã–ø—É—Å–∫–Ω–æ–π –æ—Ç–∫—Ä—ã—Ç –Ω–∞ —Ç–∞–∫—Ç–µ –≤—ã–ø—É—Å–∫–∞
                } else {
                    valve.open = false;
                }
                
                // –†–∏—Å—É–µ–º –∫–ª–∞–ø–∞–Ω
                ctx.fillStyle = valve.open ? '#FF9800' : '#888';
                ctx.fillRect(valve.x, valve.y - (valve.open ? 15 : 5), 20, valve.open ? 25 : 15);
            }
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å–∫—Ä—ã –∑–∞–∂–∏–≥–∞–Ω–∏—è
        function animateSpark() {
            for (let i = 0; i < engine.pistons.length; i++) {
                const piston = engine.pistons[i];
                const spark = document.getElementById(`spark${i+1}`);
                
                if (piston.cycle === 2 && Math.abs(piston.position) < 5) {
                    // –†–∞–±–æ—á–∏–π —Ö–æ–¥ - –∏—Å–∫—Ä–∞
                    spark.style.left = `${piston.x + piston.width/2 - 5}px`;
                    spark.style.top = `${piston.y - 10}px`;
                    spark.style.opacity = '1';
                    
                    setTimeout(() => {
                        spark.style.opacity = '0';
                    }, 50);
                }
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–≤–∏–≥–∞—Ç–µ–ª—è
        function updateEngineParams() {
            document.getElementById('engineRPM').textContent = `${engine.rpm} –æ–±/–º–∏–Ω`;
            document.getElementById('engineCycle').textContent = cycles[currentCycle];
            document.getElementById('crankshaftAngle').textContent = `${Math.round(engine.angle * 180 / Math.PI)}¬∞`;
            document.getElementById('pistonPosition').textContent = `${Math.round(engine.pistons[0].position)} –º–º`;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ç–∞–∫—Ç–∞ (—É—Å—Ä–µ–¥–Ω–µ–Ω–Ω–æ–≥–æ –ø–æ —Ü–∏–ª–∏–Ω–¥—Ä–∞–º)
            currentCycle = Math.floor((engine.angle / Math.PI * 2)) % 4;
        }

        // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –∞–Ω–∏–º–∞—Ü–∏–∏
        function animate(timestamp) {
            if (!isRunning) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–≥–ª–∞ –∫–æ–ª–µ–Ω–≤–∞–ª–∞
            engine.angle += engine.rpm * 0.0005;
            engine.flywheelAngle = engine.angle * 2;
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
            drawEngineBlock();
            drawPistons();
            drawValves();
            drawCrankshaft();
            drawFlywheel();
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å–∫—Ä—ã
            animateSpark();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            updateEngineParams();
            
            animationId = requestAnimationFrame(animate);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            initEngine();
            updateEngineParams();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        startBtn.addEventListener('click', () => {
            if (!isRunning) {
                isRunning = true;
                animate();
            }
        });

        stopBtn.addEventListener('click', () => {
            isRunning = false;
            cancelAnimationFrame(animationId);
        });

        resetBtn.addEventListener('click', () => {
            isRunning = false;
            cancelAnimationFrame(animationId);
            engine.angle = 0;
            engine.flywheelAngle = 0;
            init();
            animate();
        });

        speedControl.addEventListener('input', function() {
            engine.rpm = parseInt(this.value);
            speedValue.textContent = this.value;
        });

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        init();
    </script>
</body>
</html>
