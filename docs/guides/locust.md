# –ì–∞–π–¥ –ø–æ Locust: –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Python  

![–õ–æ–≥–æ—Ç–∏–ø Locust](images/locust-logo.png)  

**Locust** ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ Python. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ç—ã—Å—è—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å –≤–∞—à–∏–º –≤–µ–±-—Å–µ—Ä–≤–∏—Å–æ–º, API –∏–ª–∏ –¥—Ä—É–≥–∏–º HTTP-—Å–µ—Ä–≤–∏—Å–æ–º.  

Locust –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ—Ç–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –Ω–∞ Python –∏ —É–¥–æ–±–Ω—ã–º –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–∞–≥—Ä—É–∑–∫–∏.  

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫ –≤–∞—à —Å–µ—Ä–≤–∏—Å –ø–æ–≤–µ–¥–µ—Ç —Å–µ–±—è –ø–æ–¥ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π, Locust ‚Äî –æ—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä!  

---

## 1. **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ Locust**  

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã —Ä–∞–∑–±–µ—Ä–µ–º –∫–ª—é—á–µ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è:  

- **User (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)** ‚Äì –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã.  
- **Task (–ó–∞–¥–∞—á–∞)** ‚Äì –î–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, GET –∏–ª–∏ POST –∑–∞–ø—Ä–æ—Å).  
- **Load Test (–ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —Ç–µ—Å—Ç)** ‚Äì –ü—Ä–æ—Ü–µ—Å—Å, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∞—Ç–∞–∫—É—é—Ç —Å–µ—Ä–≤–µ—Ä.  
- **Web UI** ‚Äì –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Locust –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–º –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.  

Locust –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **event-driven** –ø–æ–¥—Ö–æ–¥ (—á–µ—Ä–µ–∑ gevent), —á—Ç–æ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –æ—á–µ–Ω—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º –¥–∞–∂–µ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ.  

---

## 2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Locust**  

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ `pip`:  
```bash
pip install locust
```  

–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:  
```bash
locust --version
```  

---

## 3. **–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–µ—Å—Ç–∞**  

–°–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª `locustfile.py` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è REST API (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–≥–æ, —á—Ç–æ –º—ã –¥–µ–ª–∞–ª–∏ –≤ –≥–∞–π–¥–µ –ø–æ REST API).  

### **–ü—Ä–∏–º–µ—Ä `locustfile.py`**  
```python
from locust import HttpUser, task, between

class ApiUser(HttpUser):
    wait_time = between(1, 3)  # –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (1-3 —Å–µ–∫)

    @task(3)  # –í–µ—Å –∑–∞–¥–∞—á–∏ (—á–∞—Å—Ç–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
    def get_users(self):
        self.client.get("/users")

    @task(1)
    def create_user(self):
        self.client.post(
            "/users",
            json={"id": 10, "name": "LocustUser"}
        )
```  

### **–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞**  
```bash
locust -f locustfile.py
```  

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:  
- `http://localhost:8089`  

---

## 4. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ Web UI**  

1. **–£–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ—Å—Ç–∞:**  
   - Number of users (peak) ‚Äì –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.  
   - Spawn rate ‚Äì –°–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–æ–±–∞–≤–ª—è—Ç—å –≤ —Å–µ–∫—É–Ω–¥—É.  
   - Host ‚Äì URL —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `http://localhost:5000`).  

2. **–ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç:**  
   - –ö–Ω–æ–ø–∫–∞ **Start swarming** –Ω–∞—á–∏–Ω–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É.  

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:**  
   - **Requests/s** ‚Äì –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É.  
   - **Response times** ‚Äì –ì—Ä–∞—Ñ–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞.  
   - **Failures** ‚Äì –û—à–∏–±–∫–∏ (–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è).  

---

## 5. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**  

### **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏**  
```python
class AuthUser(HttpUser):
    @task
    def login_and_access_protected(self):
        # –õ–æ–≥–∏–Ω–∏–º—Å—è –∏ –ø–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω
        response = self.client.post(
            "/login",
            json={"username": "admin", "password": "123"}
        )
        token = response.json()["access_token"]
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º—É API
        self.client.get(
            "/protected",
            headers={"Authorization": f"Bearer {token}"}
        )
```  

### **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤**  
```python
from random import randint

class RandomUser(HttpUser):
    @task
    def get_random_user(self):
        user_id = randint(1, 100)
        self.client.get(f"/users/{user_id}", name="/users/[id]")
```  

### **–ó–∞–ø—É—Å–∫ –±–µ–∑ Web UI (–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ)**  
```bash
locust -f locustfile.py --headless -u 100 -r 10 -t 1m --host=http://localhost:5000
```  
- `-u 100` ‚Äì 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.  
- `-r 10` ‚Äì 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–µ–∫—É–Ω–¥—É.  
- `-t 1m` ‚Äì –¢–µ—Å—Ç –Ω–∞ 1 –º–∏–Ω—É—Ç—É.  

---

## 6. **–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**  

–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∞ –º–æ–∂–Ω–æ:  
1. **–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É** (CSV –∏–ª–∏ JSON).  
2. **–°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ç–µ—Å—Ç—ã** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ –∏ –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞).  
3. **–ò—Å–∫–∞—Ç—å —É–∑–∫–∏–µ –º–µ—Å—Ç–∞** ‚Äì –ï—Å–ª–∏ `95% percentile` —Ä–∞—Å—Ç–µ—Ç –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏, —Å–µ—Ä–≤–µ—Ä –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è.  

---

## 7. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CI/CD**  

Locust –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ GitHub Actions:  

```yaml
name: Load Test
on: [push]
jobs:
  load-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Install Locust
        run: pip install locust
      - name: Run Locust
        run: locust -f locustfile.py --headless -u 100 -r 10 -t 1m --host=http://api.example.com
```  

---

## **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**  

Locust ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏ –≥–∏–±–∫–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –ª–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è –≤ Python-–ø—Ä–æ–µ–∫—Ç—ã.  

**–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:**  
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è —Å–≤–æ–µ–≥–æ API.  
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π.  
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∫–æ–¥ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ —Ç–µ—Å—Ç!  

–ì–æ—Ç–æ–≤—ã "–Ω–∞–≥—Ä—É–∑–∏—Ç—å" —Å–≤–æ–π —Å–µ—Ä–≤–∏—Å? –¢–æ–≥–¥–∞ –≤–ø–µ—Ä–µ–¥! üöÄ  

---  

–≠—Ç–æ—Ç –≥–∞–π–¥ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å Locust –∏ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã –∫–∞–∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª. –£–¥–∞—á–∏ –≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏!