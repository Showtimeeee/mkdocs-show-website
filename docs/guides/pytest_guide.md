# Гайд по Pytest

---

<div><img src="https://raw.githubusercontent.com/syvixor/skills-icons/8faa958456a73918dab7406acb8c2826d3cf67b6/icons/pytest.svg" title="pytest"  alt="pytest" />&nbsp;
</div>

Pytest — это фреймворк для тестирования на Python, который позволяет писать простые и масштабируемые тесты. Он поддерживает все стандартные утверждения Python и предлагает множество расширений для улучшения функциональности. Pytest широко используется в сообществе Python благодаря своей простоте и мощным возможностям.

Если вы хотите улучшить процесс тестирования ваших приложений, Pytest станет вашим надежным помощником.

## 1. **Основные концепции Pytest**

Перед тем как начать работу с Pytest, важно понять его ключевые компоненты:

- **Тестовые функции**: Функции, которые начинаются с префикса `test_` и содержат утверждения.
- **Утверждения (Assertions)**: Проверки, которые определяют, прошел ли тест успешно.
- **Фикстуры (Fixtures)**: Вспомогательные функции, которые настраивают окружение для тестов.
- **Параметризация (Parametrization)**: Возможность запуска одного теста с различными наборами данных.
- **Плагины (Plugins)**: Расширения, которые добавляют дополнительные функции в Pytest.

## 2. **Установка Pytest**

Для начала работы вам нужно установить Pytest. Это можно сделать с помощью pip:

```bash
pip install pytest
```

Проверьте установку:

```bash
pytest --version
```

## 3. **Написание первого теста**

Создайте файл `test_sample.py` и добавьте в него следующий код:

```python
def test_addition():
    assert 1 + 1 == 2

def test_subtraction():
    assert 2 - 1 == 1
```

Запустите тесты:

```bash
pytest test_sample.py
```

## 4. **Использование фикстур**

Фикстуры позволяют настраивать окружение для тестов. Вот пример использования фикстур:

```python
import pytest

@pytest.fixture
def sample_data():
    return {"key": "value"}

def test_sample_data(sample_data):
    assert sample_data["key"] == "value"
```

### Скоупы фикстур

Фикстуры могут иметь разные области видимости (скоупы):

- **function**: Фикстура вызывается для каждой тестовой функции.
- **class**: Фикстура вызывается один раз для всех тестовых методов в классе.
- **module**: Фикстура вызывается один раз для всех тестов в модуле.
- **package**: Фикстура вызывается один раз для всех тестов в пакете.
- **session**: Фикстура вызывается один раз для всех тестов в сессии.

Пример использования скоупов:

```python
@pytest.fixture(scope="module")
def module_level_fixture():
    return "module_level_data"

def test_module_level_fixture(module_level_fixture):
    assert module_level_fixture == "module_level_data"
```

## 5. **Параметризация тестов**

Параметризация позволяет запускать один тест с различными наборами данных. Вот пример:

```python
@pytest.mark.parametrize("input,expected", [
    (1, 2),
    (2, 3),
    (3, 4),
])
def test_increment(input, expected):
    assert input + 1 == expected
```

## 6. **Использование плагинов**

Pytest поддерживает множество плагинов, которые расширяют его функциональность. Вот несколько популярных плагинов:

- **pytest-xdist**: Параллельное выполнение тестов.
- **pytest-cov**: Измерение покрытия кода.
- **pytest-mock**: Мокирование объектов.
- **pytest-html**: Генерация HTML-отчетов.

Установка плагина:

```bash
pip install pytest-xdist
```

Использование плагина:

```bash
pytest -n 4
```

## 7. **Мониторинг и логирование**

Для мониторинга и логирования тестов можно использовать такие инструменты, как:

- **Allure**: Генерация отчетов для автотестов.
- **Sentry**: Отслеживание ошибок в реальном времени.

## 8. **Советы по оптимизации**

- **Используйте фикстуры**: Для настройки окружения и очистки ресурсов.
- **Параметризуйте тесты**: Для уменьшения дублирования кода.
- **Используйте плагины**: Для расширения функциональности Pytest.
- **Пишите чистые тесты**: Следуйте принципам чистого кода и тестирования.
